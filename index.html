<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>GhostRun</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=Noto+Sans+KR:wght@200;300;400&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden}
:root{
  --bg:#0a0a0d;--sf:#131316;--sf2:#1a1a1e;
  --ln:rgba(255,255,255,.07);--dim:rgba(255,255,255,.28);--mid:rgba(255,255,255,.52);
  --hi:#ede9e1;--acc:#c8f050;
  --gold:#d4b54a;--silver:#a0aab4;--bronze:#b07444;
  --fd:"Cormorant Garamond",Georgia,serif;
  --fb:"Noto Sans KR",system-ui,sans-serif;
}
body{background:var(--bg);color:var(--hi);font-family:var(--fb);
  display:flex;flex-direction:column;height:100dvh;max-width:430px;margin:0 auto;position:relative}

/* SPLASH */
#splash{position:fixed;inset:0;z-index:999;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 36px;text-align:center;transition:opacity .7s,transform .7s}
#splash.out{opacity:0;transform:scale(1.04);pointer-events:none}
.sp-grain{position:absolute;inset:0;opacity:.2;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='f'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.65' numOctaves='3'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23f)' opacity='.07'/%3E%3C/svg%3E")}
.sp-glow{position:absolute;width:420px;height:420px;border-radius:50%;background:radial-gradient(circle,rgba(200,240,80,.07) 0%,transparent 70%);top:50%;left:50%;transform:translate(-50%,-55%);animation:spPulse 4s ease-in-out infinite}
@keyframes spPulse{0%,100%{transform:translate(-50%,-55%) scale(1)}50%{transform:translate(-50%,-55%) scale(1.15)}}
.sp-lines{position:absolute;inset:0;background-image:linear-gradient(rgba(255,255,255,.025) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.025) 1px,transparent 1px);background-size:38px 38px;mask-image:radial-gradient(ellipse 80% 60% at 50% 50%,black 40%,transparent 80%)}
.sp-em{font-size:62px;margin-bottom:24px;position:relative;animation:floatGhost 3.5s ease-in-out infinite}
@keyframes floatGhost{0%,100%{transform:translateY(0)}50%{transform:translateY(-11px)}}
.sp-logo{font-family:var(--fd);font-style:italic;font-size:46px;font-weight:300;letter-spacing:-.01em;margin-bottom:14px;position:relative}
.sp-sub{font-size:15px;font-weight:300;color:var(--mid);letter-spacing:.04em;margin-bottom:8px;position:relative}
.sp-desc{font-size:12px;font-weight:200;color:var(--dim);letter-spacing:.07em;line-height:1.9;margin-bottom:54px;position:relative}
.sp-btn{background:var(--hi);border:none;border-radius:99px;padding:17px 58px;font-family:var(--fb);font-size:15px;font-weight:300;color:var(--bg);cursor:pointer;letter-spacing:.04em;transition:all .2s;position:relative;box-shadow:0 8px 30px rgba(237,233,225,.1)}
.sp-btn:active{transform:scale(.96)}
.sp-ver{position:absolute;bottom:30px;font-size:10px;font-weight:200;letter-spacing:.14em;color:rgba(255,255,255,.12)}

/* NAV */
#nav{flex-shrink:0;height:52px;display:flex;align-items:center;justify-content:space-between;padding:0 18px;border-bottom:1px solid var(--ln)}
.logo{font-family:var(--fd);font-style:italic;font-size:20px;font-weight:300}
#clock{font-size:11px;font-weight:200;color:var(--dim);font-variant-numeric:tabular-nums}

/* BOTTOM TABS */
#btabs{flex-shrink:0;display:flex;align-items:stretch;background:rgba(10,10,13,.97);border-top:1px solid var(--ln);padding-bottom:env(safe-area-inset-bottom,0px);z-index:50}
.btab{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;padding:7px 2px 6px;background:none;border:none;cursor:pointer;font-family:var(--fb);font-size:9px;font-weight:200;letter-spacing:.04em;color:var(--dim);transition:color .2s;min-width:0}
.btab svg{width:20px;height:20px;stroke:currentColor;fill:none;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round}
.btab.on{color:var(--hi)}
.btab-dot{width:4px;height:4px;border-radius:50%;background:var(--acc);opacity:0;transition:opacity .2s}
.btab.on .btab-dot{opacity:1}
.btab-run-wrap{width:42px;height:42px;border-radius:50%;background:var(--acc);display:flex;align-items:center;justify-content:center;margin-bottom:1px;transition:transform .15s,background .2s}
.btab-run-wrap svg{stroke:var(--bg);fill:var(--bg);width:18px;height:18px}
.btab.on .btab-run-wrap{background:var(--hi);transform:scale(.94)}
.btab[data-v="run"] .btab-dot{display:none}

/* VIEWS */
#main{flex:1;min-height:0;overflow:hidden;position:relative}
.mview{position:absolute;inset:0;display:flex;flex-direction:column;opacity:0;pointer-events:none;transition:opacity .22s;overflow:hidden}
.mview.on{opacity:1;pointer-events:all}

/* ‚ïê‚ïê HOME ‚ïê‚ïê */
#v-home{background:var(--bg);overflow-y:auto;scrollbar-width:none}
#v-home::-webkit-scrollbar{display:none}
.hm-hero{position:relative;height:272px;flex-shrink:0;overflow:hidden}
.hm-hero-bg{position:absolute;inset:0;background:linear-gradient(145deg,#0d0d1a 0%,#111128 60%,#0a0a0d 100%)}
.hm-hero-pattern{position:absolute;inset:0;opacity:.05;background-image:repeating-linear-gradient(45deg,var(--hi) 0,var(--hi) 1px,transparent 0,transparent 50%);background-size:22px 22px;mask-image:radial-gradient(ellipse at 50% 50%,black 50%,transparent 80%)}
.hm-hero-glow{position:absolute;width:340px;height:340px;border-radius:50%;background:radial-gradient(circle,rgba(200,240,80,.1) 0%,transparent 65%);top:50%;left:50%;transform:translate(-50%,-50%)}
.hm-hero-inner{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px 24px}
.hm-tag{font-size:9px;font-weight:200;letter-spacing:.18em;color:rgba(200,240,80,.65);background:rgba(200,240,80,.07);border:1px solid rgba(200,240,80,.14);border-radius:99px;padding:4px 14px;margin-bottom:16px}
.hm-hero-title{font-family:var(--fd);font-style:italic;font-size:32px;font-weight:300;text-align:center;line-height:1.1;margin-bottom:10px}
.hm-hero-sub{font-size:11px;font-weight:200;color:var(--dim);text-align:center;letter-spacing:.06em;margin-bottom:20px}
.hm-hero-stats{display:flex;gap:28px}
.hm-hs{display:flex;flex-direction:column;align-items:center;gap:2px}
.hm-hsv{font-family:var(--fd);font-style:italic;font-size:24px;font-weight:300;color:var(--acc);line-height:1}
.hm-hsl{font-size:8px;font-weight:200;letter-spacing:.1em;color:var(--dim)}

.hm-today{margin:16px 16px 0;padding:16px;background:var(--sf2);border:1px solid rgba(200,240,80,.13);border-radius:18px}
.hm-today-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
.hm-today-lbl{font-size:9px;font-weight:200;letter-spacing:.14em;color:rgba(200,240,80,.7)}
.hm-today-btn{background:var(--acc);border:none;border-radius:99px;padding:7px 16px;font-family:var(--fb);font-size:10px;font-weight:300;color:var(--bg);cursor:pointer;transition:opacity .2s}
.hm-today-btn:active{opacity:.8}
.hm-today-row{display:flex}
.hm-ts{flex:1;display:flex;flex-direction:column;gap:3px}
.hm-ts+.hm-ts{border-left:1px solid var(--ln);padding-left:16px}
.hm-tsl{font-size:8px;font-weight:200;letter-spacing:.1em;color:var(--dim)}
.hm-tsv{font-family:var(--fd);font-style:italic;font-size:24px;font-weight:300;line-height:1}

.hm-sec{padding:22px 16px 0}
.hm-sec-hd{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:14px}
.hm-sec-title{font-family:var(--fd);font-style:italic;font-size:22px;font-weight:300}
.hm-sec-more{font-size:10px;font-weight:200;color:var(--dim);cursor:pointer}
.hm-cbar{display:flex;align-items:center;gap:10px;padding:11px 0;border-bottom:1px solid var(--ln)}
.hm-cb-rk{font-family:var(--fd);font-style:italic;font-size:18px;font-weight:300;width:20px;flex-shrink:0;text-align:right}
.hm-cb-rk.g{color:var(--gold)}.hm-cb-rk.s{color:var(--silver)}.hm-cb-rk.b{color:var(--bronze)}.hm-cb-rk.o{color:var(--dim)}
.hm-cb-em{font-size:15px;flex-shrink:0}
.hm-cb-info{flex:1;min-width:0}
.hm-cb-name{font-size:13px;font-weight:300;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.hm-cb-dist{font-size:10px;font-weight:200;color:var(--dim)}
.hm-cb-bar{width:50px;flex-shrink:0}
.hm-cb-bg{height:2px;background:rgba(255,255,255,.07);border-radius:2px}
.hm-cb-fill{height:2px;border-radius:2px}

.hm-feat{background:var(--sf);border:1px solid var(--ln);border-radius:18px;overflow:hidden;cursor:pointer;transition:transform .15s;margin-bottom:12px}
.hm-feat:active{transform:scale(.985)}
.hm-feat-img{height:140px;background:linear-gradient(145deg,#14142a,#0d0d1a);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
.hm-feat-glow{position:absolute;inset:0;background:radial-gradient(ellipse at 30% 60%,rgba(200,240,80,.1),transparent 55%)}
.hm-feat-em{font-size:56px;position:relative;filter:drop-shadow(0 0 20px rgba(200,240,80,.18))}
.hm-feat-body{padding:16px 18px 18px}
.hm-feat-tag{font-size:9px;font-weight:200;letter-spacing:.14em;color:rgba(200,240,80,.7);margin-bottom:7px}
.hm-feat-title{font-family:var(--fd);font-style:italic;font-size:20px;font-weight:300;line-height:1.25;margin-bottom:7px}
.hm-feat-desc{font-size:11px;font-weight:200;color:var(--dim);line-height:1.65}
.hm-feat-foot{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
.hm-feat-by{font-size:9px;font-weight:200;color:rgba(255,255,255,.2)}
.hm-feat-cta{font-size:9px;font-weight:200;color:var(--acc);opacity:.8}

.hm-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.hm-card{background:var(--sf);border:1px solid var(--ln);border-radius:14px;overflow:hidden;cursor:pointer;transition:transform .15s}
.hm-card:active{transform:scale(.97)}
.hm-card-top{height:82px;background:linear-gradient(145deg,#161620,#0e0e18);display:flex;align-items:center;justify-content:center;font-size:32px;position:relative}
.hm-card-glow{position:absolute;inset:0;background:radial-gradient(circle at 70% 30%,rgba(200,240,80,.07),transparent 60%)}
.hm-card-body{padding:10px 12px 12px}
.hm-card-tag{font-size:8px;font-weight:200;letter-spacing:.12em;color:var(--acc);opacity:.7;margin-bottom:4px}
.hm-card-title{font-size:11px;font-weight:300;line-height:1.4}
.hm-card-time{font-size:9px;font-weight:200;color:var(--dim);margin-top:4px}

/* ‚ïê‚ïê RUN ‚ïê‚ïê */
#v-run{background:var(--bg)}
.rstate{display:none;flex-direction:column;height:100%;overflow-y:auto;scrollbar-width:none}
.rstate::-webkit-scrollbar{display:none}
.rstate.on{display:flex}

.rs-top{padding:20px 18px 16px;border-bottom:1px solid var(--ln);flex-shrink:0}
.rs-title{font-family:var(--fd);font-style:italic;font-size:26px;font-weight:300;margin-bottom:4px}
.rs-sub{font-size:11px;font-weight:200;color:var(--dim)}

#map-wrap{flex-shrink:0;height:220px;margin:16px 16px 0;border-radius:18px;border:1px solid var(--ln);overflow:hidden;position:relative;background:var(--sf2)}
#gmap{width:100%;height:100%}
.map-ph{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;background:radial-gradient(ellipse at 50% 40%,#111124,#0a0a0d);pointer-events:none}
.map-ph.hide{display:none}
.map-ph-em{font-size:32px;opacity:.35}
.map-ph-txt{font-size:11px;font-weight:200;color:var(--dim);text-align:center;padding:0 20px;line-height:1.7}
.loc-btn{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:7px;background:rgba(10,10,13,.88);border:1px solid rgba(255,255,255,.12);border-radius:99px;padding:9px 18px;cursor:pointer;backdrop-filter:blur(12px);font-family:var(--fb);font-size:11px;font-weight:200;color:var(--hi);transition:all .2s;white-space:nowrap}
.loc-btn.on{border-color:rgba(200,240,80,.4);color:var(--acc)}
.loc-dot{width:8px;height:8px;border-radius:50%;background:var(--dim);flex-shrink:0;transition:all .3s}
.loc-btn.on .loc-dot{background:var(--acc);box-shadow:0 0 8px rgba(200,240,80,.6)}

.rs-body{padding:16px 16px 0;flex:1}
.rs-lbl{font-size:9px;font-weight:200;letter-spacing:.14em;color:var(--dim);margin-bottom:10px}
.gt-row{display:flex;gap:8px;margin-bottom:18px}
.gt{flex:1;background:var(--sf);border:1px solid var(--ln);border-radius:14px;padding:12px 4px;text-align:center;cursor:pointer;transition:all .2s}
.gt.on{border-color:rgba(200,240,80,.4);background:rgba(200,240,80,.06)}
.gt-em{font-size:18px;margin-bottom:4px}
.gt-nm{font-size:10px;font-weight:200;color:var(--mid)}
.gt.on .gt-nm{color:var(--hi)}
.gv-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:20px}
.gv{background:var(--sf);border:1px solid var(--ln);border-radius:12px;padding:11px 4px;text-align:center;cursor:pointer;transition:all .2s}
.gv.on{border-color:rgba(200,240,80,.35);background:rgba(200,240,80,.06)}
.gv-n{font-family:var(--fd);font-style:italic;font-size:20px;font-weight:300;display:block}
.gv-u{font-size:9px;font-weight:200;color:var(--dim)}
.rs-start{margin:0 16px 16px;background:var(--hi);border:none;border-radius:18px;padding:17px;font-family:var(--fb);font-size:15px;font-weight:300;color:var(--bg);cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:opacity .2s;flex-shrink:0;letter-spacing:.03em}
.rs-start:active{opacity:.85}

/* active run */
.ra-map-big{flex-shrink:0;height:300px;position:relative;overflow:hidden;background:var(--sf2)}
#gmap-active{width:100%;height:100%}
.ra-map-ph{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;background:radial-gradient(ellipse at 50% 40%,#111124,#0a0a0d)}
.ra-map-ph.hide{display:none}
.ra-stats{display:flex;border-top:1px solid var(--ln);border-bottom:1px solid var(--ln);flex-shrink:0}
.ra-st{flex:1;display:flex;flex-direction:column;align-items:center;padding:16px 4px;gap:4px;position:relative}
.ra-st+.ra-st::before{content:'';position:absolute;left:0;top:15%;height:70%;width:1px;background:var(--ln)}
.ra-sl{font-size:8px;font-weight:200;letter-spacing:.1em;color:var(--dim)}
.ra-sv{font-family:var(--fd);font-style:italic;font-size:30px;font-weight:300;line-height:1}
.ra-su{font-size:9px;font-weight:200;color:var(--dim)}
.ra-goal{padding:14px 18px;background:var(--sf);border-bottom:1px solid var(--ln);flex-shrink:0}
.ra-gl{font-size:9px;font-weight:200;letter-spacing:.1em;color:var(--dim);margin-bottom:7px;display:flex;justify-content:space-between}
.ra-bar{height:3px;background:rgba(255,255,255,.08);border-radius:2px;overflow:visible;position:relative}
.ra-fill{height:3px;border-radius:2px;background:var(--acc);transition:width .5s}
.ra-ctrl{display:flex;gap:10px;padding:18px 16px 20px;flex-shrink:0}
.ra-stop{flex:1;background:rgba(255,70,70,.1);border:1px solid rgba(255,70,70,.22);border-radius:16px;padding:16px;font-family:var(--fb);font-size:14px;font-weight:300;color:rgba(255,110,110,.9);cursor:pointer;transition:all .2s}
.ra-stop:active{background:rgba(255,70,70,.2)}
.ra-pause{width:56px;height:56px;background:var(--sf);border:1px solid var(--ln);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;transition:all .2s}
.ra-pause:active{background:rgba(255,255,255,.07)}

/* finish */
#rfinish{overflow-y:auto;scrollbar-width:none}
#rfinish::-webkit-scrollbar{display:none}
.rf-top{padding:30px 20px 22px;text-align:center;border-bottom:1px solid var(--ln)}
.rf-em{font-size:52px;margin-bottom:14px}
.rf-title{font-family:var(--fd);font-style:italic;font-size:28px;font-weight:300;margin-bottom:5px}
.rf-msg{font-size:12px;font-weight:200;color:var(--dim)}
.rf-grid{display:grid;grid-template-columns:1fr 1fr}
.rf-cell{padding:20px 18px;display:flex;flex-direction:column;gap:4px;border-bottom:1px solid var(--ln)}
.rf-cell:nth-child(odd){border-right:1px solid var(--ln)}
.rf-cl{font-size:9px;font-weight:200;letter-spacing:.1em;color:var(--dim)}
.rf-cv{font-family:var(--fd);font-style:italic;font-size:34px;font-weight:300;line-height:1}
.rf-cu{font-size:11px;font-weight:200;color:var(--dim)}
.rf-acts{display:flex;gap:10px;padding:20px 16px 28px}
.rf-shot{flex:1;background:var(--hi);border:none;border-radius:16px;padding:16px;font-family:var(--fb);font-size:13px;font-weight:300;color:var(--bg);cursor:pointer;display:flex;align-items:center;justify-content:center;gap:7px;transition:opacity .2s}
.rf-shot:active{opacity:.85}
.rf-done{background:var(--sf);border:1px solid var(--ln);border-radius:16px;padding:16px 20px;font-family:var(--fb);font-size:13px;font-weight:200;color:var(--mid);cursor:pointer}

/* ‚ïê‚ïê CREW ‚ïê‚ïê */
#v-crew{background:var(--bg)}
#no-crew{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px 28px 80px;text-align:center;overflow-y:auto;scrollbar-width:none}
#no-crew::-webkit-scrollbar{display:none}
.nc-em{font-size:54px;margin-bottom:20px;animation:floatGhost 3.5s ease-in-out infinite}
.nc-title{font-family:var(--fd);font-style:italic;font-size:26px;font-weight:300;margin-bottom:8px}
.nc-sub{font-size:12px;font-weight:200;color:var(--dim);line-height:1.75;margin-bottom:32px}
.nc-actions{display:flex;flex-direction:column;gap:10px;width:100%}
.nc-primary{background:var(--hi);border:none;border-radius:16px;padding:15px 20px;font-family:var(--fb);font-size:13px;font-weight:300;color:var(--bg);cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:opacity .2s}
.nc-primary:active{opacity:.85}
.nc-sec{background:var(--sf);border:1px solid var(--ln);border-radius:16px;padding:15px 20px;font-family:var(--fb);font-size:13px;font-weight:200;color:var(--mid);cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px}
.nc-divider{display:flex;align-items:center;gap:10px;padding:2px 0}
.nc-divider::before,.nc-divider::after{content:'';flex:1;height:1px;background:var(--ln)}
.nc-divider span{font-size:10px;font-weight:200;color:rgba(255,255,255,.15)}
.nc-nearby{width:100%;background:var(--sf);border:1px solid var(--ln);border-radius:16px;padding:14px 16px}
.nc-nl{font-size:9px;font-weight:200;letter-spacing:.12em;color:var(--dim);margin-bottom:10px}
.nc-nr{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid var(--ln)}
.nc-nr:last-child{border-bottom:none;padding-bottom:0}
.nc-nem{font-size:15px;flex-shrink:0}
.nc-ni{flex:1;min-width:0}
.nc-nn{font-size:12px;font-weight:300}
.nc-nm{font-size:9px;font-weight:200;color:var(--dim);margin-top:1px}
.nc-npct{font-family:var(--fd);font-style:italic;font-size:15px;color:var(--acc);opacity:.8;flex-shrink:0}
.nc-njoin{background:rgba(200,240,80,.1);border:1px solid rgba(200,240,80,.22);border-radius:99px;padding:5px 13px;font-family:var(--fb);font-size:10px;font-weight:300;color:rgba(200,240,80,.85);cursor:pointer;flex-shrink:0}

#crew-content{display:none;flex-direction:column;flex:1;overflow:hidden}
#ctabs{flex-shrink:0;display:flex;padding:0 18px;border-bottom:1px solid var(--ln);overflow-x:auto;scrollbar-width:none;background:var(--bg)}
#ctabs::-webkit-scrollbar{display:none}
.ctab{flex-shrink:0;background:none;border:none;border-bottom:1.5px solid transparent;padding:12px 12px 9px;font-family:var(--fb);font-size:10px;font-weight:200;letter-spacing:.07em;color:var(--dim);cursor:pointer;transition:all .25s;white-space:nowrap}
.ctab.on{color:var(--hi);border-bottom-color:var(--hi)}
.cpane{flex:1;display:none;flex-direction:column;overflow-y:auto;scrollbar-width:none;padding:0 18px 100px}
.cpane::-webkit-scrollbar{display:none}
.cpane.on{display:flex}
.crew-hdr{display:flex;justify-content:space-between;align-items:flex-start;padding:18px 0 14px;border-bottom:1px solid var(--ln)}
.crew-hdr-name{font-family:var(--fd);font-style:italic;font-size:22px;font-weight:300}
.crew-hdr-sub{font-size:10px;font-weight:200;color:var(--dim);margin-top:2px}
.crew-hdr-loc{font-size:10px;font-weight:200;color:rgba(200,240,80,.7);margin-top:2px}
.crew-expert{background:linear-gradient(135deg,rgba(212,181,74,.14),rgba(200,240,80,.07));border:1px solid rgba(212,181,74,.28);border-radius:99px;padding:5px 11px;font-size:10px;font-weight:300;color:rgba(212,181,74,.9);flex-shrink:0;margin-top:4px}
.gc-card{background:var(--sf);border:1px solid var(--ln);border-radius:16px;padding:16px;margin:14px 0}
.gc-top{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:12px}
.gc-lbl{font-size:9px;font-weight:200;letter-spacing:.12em;color:var(--dim);margin-bottom:5px}
.gc-nums{display:flex;align-items:baseline;gap:3px}
.gc-cur{font-family:var(--fd);font-style:italic;font-size:36px;font-weight:300;line-height:1}
.gc-sep,.gc-tot{font-size:14px;font-weight:200;color:var(--dim)}
.gc-unit{font-size:10px;font-weight:200;color:var(--dim);opacity:.5;margin-left:2px}
.gc-pct{font-family:var(--fd);font-style:italic;font-size:26px;font-weight:300;color:var(--acc);opacity:.85}
.prog{height:1px;background:rgba(255,255,255,.08);position:relative;overflow:visible;margin-bottom:12px}
.pf{height:1px;background:var(--acc);transition:width 1.4s cubic-bezier(.4,0,.2,1);position:relative}
.pd{position:absolute;right:-3px;top:-2.5px;width:6px;height:6px;border-radius:50%;background:var(--acc);box-shadow:0 0 8px rgba(200,240,80,.5)}
.gc-meta{display:flex}
.gm{flex:1;display:flex;flex-direction:column;gap:2px}
.gm+.gm{border-left:1px solid var(--ln);padding-left:12px}
.gm-l{font-size:8px;font-weight:200;letter-spacing:.1em;color:var(--dim)}
.gm-v{font-size:13px;font-weight:300;color:var(--mid)}
.gm-v.a{color:var(--acc);opacity:.85}
.lb-hdr{display:flex;justify-content:space-between;padding-top:4px;margin-bottom:10px}
.lb-ttl{font-size:9px;font-weight:200;letter-spacing:.12em;color:var(--dim)}
.lb-cnt{font-size:9px;font-weight:200;color:rgba(255,255,255,.15)}
.lbrow{display:flex;align-items:center;gap:9px;padding:10px 0;border-bottom:1px solid var(--ln)}
.lbrow.click{cursor:pointer;border-radius:8px;padding:10px 6px;margin:0 -6px;transition:background .15s}
.lbrow.click:active{background:rgba(255,255,255,.04)}
.lbrow.me .lb-nm{color:var(--hi)}.lbrow.me .lb-d{color:var(--acc)}
.lbpos{width:17px;font-size:11px;font-weight:300;text-align:center;color:var(--dim);flex-shrink:0}
.lbpos.g{color:var(--gold)}.lbpos.s{color:var(--silver)}.lbpos.b{color:var(--bronze)}
.lbem{font-size:15px;flex-shrink:0}
.lb-nc{flex:1;min-width:0;display:flex;flex-direction:column;gap:1px}
.lb-nm{font-size:12px;font-weight:200;color:var(--mid);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.lb-hint{font-size:9px;font-weight:200;color:rgba(255,255,255,.2)}
.lb-rt{flex-shrink:0;display:flex;flex-direction:column;align-items:flex-end;gap:3px}
.lb-d{font-size:12px;font-weight:300;color:var(--mid)}
.lb-bg{width:40px;height:1px;background:rgba(255,255,255,.07)}
.lb-bar{height:1px}.lb-bar.me{background:var(--acc)}.lb-bar.g{background:var(--gold)}.lb-bar.s{background:var(--silver)}.lb-bar.b{background:var(--bronze)}.lb-bar.o{background:rgba(255,255,255,.18)}
.nb-hdr{padding:18px 0 10px;border-bottom:1px solid var(--ln)}
.nb-area{font-family:var(--fd);font-style:italic;font-size:20px;font-weight:300}
.nb-desc{font-size:10px;font-weight:200;color:var(--dim);margin-top:3px}
.nb-row{padding:14px 0;border-bottom:1px solid var(--ln)}
.nb-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.nb-rn{font-family:var(--fd);font-style:italic;font-size:18px;flex-shrink:0}
.nb-rn.g{color:var(--gold)}.nb-rn.s{color:var(--silver)}.nb-rn.b{color:var(--bronze)}.nb-rn.o{color:var(--acc)}
.nb-cname{font-size:14px;font-weight:300}.nb-mine{font-size:8px;background:rgba(200,240,80,.1);border:1px solid rgba(200,240,80,.2);border-radius:99px;padding:2px 7px;color:rgba(200,240,80,.8)}
.nb-cmeta{font-size:9px;font-weight:200;color:var(--dim)}.nb-pct{font-family:var(--fd);font-style:italic;font-size:22px;color:var(--acc);opacity:.85}
.nb-prog{height:1px;background:rgba(255,255,255,.08);position:relative;overflow:visible;margin-bottom:10px}
.nb-pf{height:1px;background:rgba(200,240,80,.5);position:relative}
.nb-pd{position:absolute;right:-2px;top:-2px;width:5px;height:5px;border-radius:50%;background:rgba(200,240,80,.7)}
.nb-bot{display:flex;justify-content:space-between;align-items:center}
.nb-ghosts{font-size:14px;letter-spacing:.02em}.nb-nums{display:flex;gap:14px}
.nbn{display:flex;flex-direction:column;align-items:flex-end;gap:1px}
.nbn-l{font-size:8px;font-weight:200;letter-spacing:.1em;color:var(--dim)}.nbn-v{font-family:var(--fd);font-style:italic;font-size:14px}
.past-hdr{display:flex;justify-content:space-between;align-items:center;padding:18px 0 12px;border-bottom:1px solid var(--ln)}
.past-title{font-family:var(--fd);font-style:italic;font-size:18px;font-weight:300}
.expert-btn{display:flex;align-items:center;gap:5px;background:rgba(200,240,80,.1);border:1px solid rgba(200,240,80,.22);border-radius:99px;padding:6px 12px;font-family:var(--fb);font-size:10px;font-weight:300;color:rgba(200,240,80,.85);cursor:pointer}
.past-card{display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--ln)}
.pc-em{font-size:20px;flex-shrink:0}
.pc-info{flex:1;min-width:0;display:flex;flex-direction:column;gap:3px}
.pc-name{font-size:13px;font-weight:300}.pc-meta{font-size:10px;font-weight:200;color:var(--dim)}
.pc-xb{background:linear-gradient(135deg,rgba(212,181,74,.14),rgba(200,240,80,.07));border:1px solid rgba(212,181,74,.28);border-radius:99px;padding:2px 8px;font-size:8px;color:rgba(212,181,74,.85);display:inline-block;margin-top:3px}
.pc-right{flex-shrink:0;display:flex;flex-direction:column;align-items:flex-end;gap:3px}
.pc-rank{font-family:var(--fd);font-style:italic;font-size:18px;font-weight:300}
.pc-rank.g{color:var(--gold)}.pc-rank.s{color:var(--silver)}.pc-rank.b{color:var(--bronze)}.pc-rank.o{color:var(--acc)}
.pc-dist{font-size:10px;font-weight:200;color:var(--dim)}

/* ‚ïê‚ïê SHOT ‚ïê‚ïê */
#v-shot{padding:10px 14px 0;background:var(--bg)}
#card{flex:1;position:relative;border-radius:18px;overflow:hidden;background:#101012;min-height:0}
#bg-img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity .6s}
#empty-state{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;background:radial-gradient(ellipse at 50% 40%,#13131a,#0a0a0d)}
.e-grain{position:absolute;inset:0;opacity:.3;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='f'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.65' numOctaves='3'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23f)' opacity='.07'/%3E%3C/svg%3E")}
.e-icon{font-size:28px;opacity:.18;filter:grayscale(1);position:relative}
.e-hint{font-size:10px;font-weight:200;letter-spacing:.14em;color:var(--dim);opacity:.55;position:relative}
#ovs{position:absolute;inset:0;z-index:5;pointer-events:none}
.ov{position:absolute;inset:0;transition:opacity .35s}.ov.off{opacity:0}
.ft{position:absolute;top:0;left:0;right:0;height:170px;background:linear-gradient(180deg,rgba(0,0,0,.75),transparent)}
.fb{position:absolute;bottom:0;left:0;right:0;height:260px;background:linear-gradient(0deg,rgba(0,0,0,.92) 0%,rgba(0,0,0,.4) 55%,transparent)}
.ov-hd{position:absolute;top:0;left:0;right:0;padding:16px 16px 0;display:flex;justify-content:space-between;align-items:flex-start}
.runner{display:flex;align-items:center;gap:6px;cursor:pointer;pointer-events:all}
.r-em{font-size:17px;line-height:1}.r-nm{font-size:12px;font-weight:200;color:rgba(255,255,255,.72)}
.ov-dt{font-size:9px;font-weight:200;color:rgba(255,255,255,.22);text-align:right;line-height:1.9}
.chip{position:absolute;display:flex;align-items:baseline;gap:4px;background:rgba(0,0,0,.55);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.09);border-radius:99px;padding:5px 12px;pointer-events:none}
.ch-n{font-family:var(--fd);font-style:italic;font-size:20px;line-height:1}
.ch-n.g{color:var(--gold)}.ch-n.s{color:var(--silver)}.ch-n.b{color:var(--bronze)}.ch-n.o{color:var(--acc)}
.ch-of{font-size:10px;font-weight:200;color:rgba(255,255,255,.28)}
.gchip{top:16px;right:16px}
.gboard{position:absolute;right:14px;bottom:68px;display:flex;flex-direction:column;gap:2px;pointer-events:none}
.gb-lbl{font-size:8px;font-weight:200;letter-spacing:.12em;color:rgba(255,255,255,.18);text-align:right;margin-bottom:3px}
.gb-row{display:flex;align-items:center;gap:5px;padding:4px 8px;background:rgba(0,0,0,.45);border:1px solid rgba(255,255,255,.06);border-radius:6px}
.gb-row.me{background:rgba(200,240,80,.08);border-color:rgba(200,240,80,.2)}
.gb-n{font-size:9px;font-weight:300;color:rgba(255,255,255,.22);width:11px;text-align:right}
.gb-n.g{color:var(--gold)}.gb-n.s{color:var(--silver)}.gb-n.b{color:var(--bronze)}
.gb-e{font-size:11px}.gb-d{font-size:9px;font-weight:300;color:rgba(255,255,255,.42);margin-left:auto}
.gb-d.me{color:var(--acc)}
.g-bot{position:absolute;bottom:0;left:0;right:64px;padding:0 18px 18px}
.g-dist{font-family:var(--fd);font-style:italic;font-size:52px;font-weight:300;line-height:.9;letter-spacing:-.02em}
.g-du{font-family:var(--fb);font-size:15px;font-weight:200;color:var(--mid);margin-left:3px;vertical-align:middle}
.g-stats{display:flex;margin-top:9px}
.g-s{flex:1;display:flex;flex-direction:column;gap:2px}
.g-s+.g-s{border-left:1px solid rgba(255,255,255,.07);padding-left:13px}
.g-sl{font-size:8px;font-weight:200;letter-spacing:.1em;color:rgba(255,255,255,.2)}
.g-sv{font-size:13px;font-weight:300;color:var(--mid)}
.g-foot{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
.g-brand{font-size:9px;font-weight:200;letter-spacing:.16em;color:rgba(255,255,255,.1)}
.g-tag{font-size:9px;font-weight:200;color:rgba(200,240,80,.42)}
#mmg{width:40px;height:40px;border-radius:5px;border:1px solid rgba(255,255,255,.07);background:rgba(0,0,0,.4);position:absolute;right:16px;bottom:20px}
.p-logo{font-family:var(--fd);font-style:italic;font-size:13px;font-weight:300;color:rgba(255,255,255,.3)}
.p-mapbg{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
#mmp{width:62%;max-width:220px;aspect-ratio:1;opacity:.25}
.p-chip{bottom:116px;left:50%;top:auto;transform:translateX(-50%)}
.p-bot{position:absolute;bottom:0;left:0;right:0;padding:0 18px 18px;display:flex;justify-content:space-between;align-items:flex-end}
.p-stat{display:flex;flex-direction:column;gap:2px}
.p-l{font-size:8px;font-weight:200;letter-spacing:.12em;color:rgba(255,255,255,.22)}
.p-v{font-family:var(--fd);font-style:italic;font-size:29px;color:var(--hi);line-height:1}
.p-u{font-family:var(--fb);font-size:13px;font-weight:200;color:var(--mid)}
.st-vign{position:absolute;inset:0;background:radial-gradient(ellipse at center,transparent 30%,rgba(0,0,0,.62) 100%)}
.st-logo{font-size:9px;font-weight:200;letter-spacing:.2em;color:rgba(255,255,255,.2)}
.st-bot{position:absolute;bottom:0;left:0;right:0;padding:0 18px 18px}
.st-rrow{display:flex;align-items:baseline;gap:8px;margin-bottom:4px}
.st-rn{font-family:var(--fd);font-style:italic;font-size:34px;line-height:1}
.st-rn.g{color:var(--gold)}.st-rn.s{color:var(--silver)}.st-rn.b{color:var(--bronze)}.st-rn.o{color:var(--acc)}
.st-of{font-size:12px;font-weight:200;color:rgba(255,255,255,.3)}
.st-dist{font-family:var(--fd);font-style:italic;font-size:50px;line-height:.9;letter-spacing:-.02em}
.st-du{font-family:var(--fb);font-size:17px;font-weight:200;color:var(--mid);margin-left:2px}
.st-sub{display:flex;gap:14px;margin-top:8px}
.ss{display:flex;flex-direction:column;gap:1px}
.ss-l{font-size:8px;font-weight:200;letter-spacing:.1em;color:rgba(255,255,255,.2)}
.ss-v{font-size:13px;font-weight:300;color:var(--mid)}
.st-badge{position:absolute;bottom:16px;right:16px;width:82px;height:82px;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;border:1px solid rgba(255,255,255,.1);background:rgba(0,0,0,.44);backdrop-filter:blur(8px)}
.st-badge::before{content:"";position:absolute;inset:5px;border-radius:50%;border:1px solid rgba(200,240,80,.1)}
.sb-em{font-size:23px;line-height:1}.sb-done{font-size:7px;font-weight:200;letter-spacing:.12em;color:rgba(200,240,80,.5)}.sb-date{font-size:7px;font-weight:200;color:rgba(255,255,255,.18)}
#mms{position:absolute;top:70px;right:18px;width:42px;height:42px;border-radius:6px;border:1px solid rgba(255,255,255,.07);background:rgba(0,0,0,.4)}
#tbar{flex-shrink:0;display:flex;gap:6px;padding:8px 14px 5px;overflow-x:auto;scrollbar-width:none}
#tbar::-webkit-scrollbar{display:none}
.th{flex-shrink:0;background:none;border:1px solid var(--ln);border-radius:99px;padding:6px 14px;font-family:var(--fb);font-size:10px;font-weight:200;letter-spacing:.06em;color:var(--dim);cursor:pointer;transition:all .2s}
.th.on{border-color:rgba(255,255,255,.3);color:var(--hi)}
#shot-acts{flex-shrink:0;display:flex;gap:8px;padding:5px 14px 10px}
.ai{width:46px;background:var(--sf);border:1px solid var(--ln);border-radius:13px;display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0}
.ai svg{width:17px;height:17px;stroke:var(--mid);stroke-width:1.5;fill:none;stroke-linecap:round;stroke-linejoin:round}
.asave{flex:1;background:var(--hi);border:none;border-radius:13px;font-family:var(--fb);font-size:13px;font-weight:300;letter-spacing:.04em;color:var(--bg);cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;transition:opacity .2s}
.asave:active{opacity:.85}

/* ‚ïê‚ïê RECORDS ‚ïê‚ïê */
#v-records{background:var(--bg);overflow-y:auto;scrollbar-width:none}
#v-records::-webkit-scrollbar{display:none}
.rec-hero{padding:26px 18px 22px;border-bottom:1px solid var(--ln)}
.rec-hero-lbl{font-size:9px;font-weight:200;letter-spacing:.18em;color:var(--dim);margin-bottom:12px}
.rec-big{display:flex;align-items:flex-end;gap:6px;margin-bottom:5px}
.rec-big-n{font-family:var(--fd);font-style:italic;font-size:84px;font-weight:300;line-height:.82;letter-spacing:-.03em}
.rec-big-u{font-family:var(--fd);font-style:italic;font-size:30px;font-weight:300;color:var(--dim);padding-bottom:8px}
.rec-hero-sub{font-size:12px;font-weight:200;color:var(--dim);margin-bottom:24px}
.rec-3{display:flex;border-top:1px solid var(--ln);padding-top:0}
.rec-3s{flex:1;padding:16px 0;display:flex;flex-direction:column;align-items:center;gap:3px}
.rec-3s+.rec-3s{border-left:1px solid var(--ln)}
.rec-3sl{font-size:8px;font-weight:200;letter-spacing:.1em;color:var(--dim)}
.rec-3sv{font-family:var(--fd);font-style:italic;font-size:30px;font-weight:300;line-height:1}
.rec-3su{font-size:10px;font-weight:200;color:var(--dim)}
.rec-cal{padding:22px 18px 0}
.rec-cal-lbl{font-size:9px;font-weight:200;letter-spacing:.14em;color:var(--dim);margin-bottom:12px}
.cal-grid{display:flex;gap:4px;flex-wrap:wrap}
.cal-d{width:13px;height:13px;border-radius:3px;background:rgba(255,255,255,.06)}
.cal-d.run{background:rgba(200,240,80,.5)}.cal-d.today{background:var(--acc);box-shadow:0 0 7px rgba(200,240,80,.5)}
.rec-target{margin:22px 18px 0;background:var(--sf);border:1px solid var(--ln);border-radius:18px;padding:18px}
.rt-top{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:12px}
.rt-lbl{font-size:9px;font-weight:200;letter-spacing:.12em;color:var(--dim);margin-bottom:4px}
.rt-val{font-family:var(--fd);font-style:italic;font-size:26px;font-weight:300}
.rt-pct{font-family:var(--fd);font-style:italic;font-size:20px;color:var(--acc);opacity:.85}
.rt-bar{height:3px;background:rgba(255,255,255,.07);border-radius:2px;overflow:hidden}
.rt-fill{height:100%;background:var(--acc);border-radius:2px;transition:width 1.4s cubic-bezier(.4,0,.2,1)}
.rec-log{padding:24px 18px 0}
.rec-log-hd{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:16px}
.rec-log-title{font-family:var(--fd);font-style:italic;font-size:24px;font-weight:300}
.rec-log-cnt{font-size:10px;font-weight:200;color:var(--dim)}
.log-item{display:flex;align-items:center;gap:14px;padding:15px 0;border-bottom:1px solid var(--ln)}
.log-date{flex-shrink:0;display:flex;flex-direction:column;align-items:center;width:36px}
.log-mo{font-size:8px;font-weight:200;color:var(--dim)}
.log-dy{font-family:var(--fd);font-style:italic;font-size:30px;font-weight:300;line-height:1}
.log-cv{width:52px;height:52px;flex-shrink:0;border-radius:10px;border:1px solid rgba(255,255,255,.07);background:rgba(0,0,0,.4)}
.log-info{flex:1;display:flex;flex-direction:column;gap:4px}
.log-crew{font-size:9px;font-weight:200;background:var(--sf2);border:1px solid var(--ln);border-radius:99px;padding:3px 9px;color:var(--dim);display:inline-flex;align-items:center;width:fit-content}
.log-km{font-family:var(--fd);font-style:italic;font-size:30px;font-weight:300;line-height:1}
.log-sub{font-size:11px;font-weight:200;color:var(--dim)}
.log-right{flex-shrink:0;display:flex;flex-direction:column;align-items:flex-end;gap:4px}
.log-rn{font-family:var(--fd);font-style:italic;font-size:24px;font-weight:300}
.log-rn.g{color:var(--gold)}.log-rn.s{color:var(--silver)}.log-rn.b{color:var(--bronze)}.log-rn.o{color:var(--acc)}
.log-kcal{font-size:9px;font-weight:200;color:var(--dim)}
.rec-crews{padding:24px 18px 100px}
.rec-crews-title{font-family:var(--fd);font-style:italic;font-size:24px;font-weight:300;margin-bottom:16px}
.rcr{display:flex;align-items:center;gap:12px;padding:14px 0;border-bottom:1px solid var(--ln)}
.rcr-em{font-size:24px;flex-shrink:0}
.rcr-info{flex:1;display:flex;flex-direction:column;gap:3px}
.rcr-name{font-size:14px;font-weight:300}.rcr-meta{font-size:10px;font-weight:200;color:var(--dim)}
.rcr-right{flex-shrink:0;display:flex;flex-direction:column;align-items:flex-end;gap:4px}
.rcr-xp{background:rgba(200,240,80,.1);border:1px solid rgba(200,240,80,.22);border-radius:99px;padding:3px 10px;font-size:9px;color:rgba(200,240,80,.85)}
.rcr-rank{font-family:var(--fd);font-style:italic;font-size:22px;font-weight:300}
.rcr-rank.g{color:var(--gold)}.rcr-rank.s{color:var(--silver)}.rcr-rank.b{color:var(--bronze)}.rcr-rank.o{color:var(--acc)}

/* ‚ïê‚ïê MODALS ‚ïê‚ïê */
.modal{position:fixed;inset:0;z-index:80;display:flex;align-items:flex-end;justify-content:center;background:rgba(0,0,0,.65);backdrop-filter:blur(14px);opacity:0;pointer-events:none;transition:opacity .28s}
.modal.on{opacity:1;pointer-events:all}
.m-box{width:100%;max-width:430px;background:#111114;border:1px solid var(--ln);border-bottom:none;border-radius:22px 22px 0 0;padding:24px 20px 44px;transform:translateY(16px);transition:transform .3s;max-height:90dvh;overflow-y:auto;scrollbar-width:none}
.m-box::-webkit-scrollbar{display:none}
.modal.on .m-box{transform:translateY(0)}
.m-title{font-family:var(--fd);font-style:italic;font-size:22px;font-weight:300;margin-bottom:5px}
.m-sub{font-size:11px;font-weight:200;color:var(--dim);margin-bottom:22px;line-height:1.6}
.m-cancel{width:100%;background:none;border:1px solid var(--ln);border-radius:14px;padding:12px;font-family:var(--fb);font-size:12px;font-weight:200;color:var(--dim);cursor:pointer;margin-top:8px}
.m-ok{width:100%;background:var(--hi);border:none;border-radius:14px;padding:14px;font-family:var(--fb);font-size:13px;font-weight:300;color:var(--bg);cursor:pointer;transition:opacity .2s}
.m-ok:active{opacity:.85}
.mf{margin-bottom:16px}.ml{font-size:9px;font-weight:200;letter-spacing:.12em;color:var(--dim);margin-bottom:8px}
.mi{width:100%;background:var(--sf);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:12px 14px;font-family:var(--fb);font-size:14px;font-weight:200;color:var(--hi);outline:none;transition:border-color .2s;caret-color:var(--acc)}
.mi:focus{border-color:rgba(200,240,80,.35)}
.mi::placeholder{color:rgba(255,255,255,.18)}
.em-row{display:flex;gap:8px;flex-wrap:wrap}
.em-opt{width:46px;height:46px;background:var(--sf);border:1px solid var(--ln);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;cursor:pointer;transition:all .2s}
.em-opt.on{border-color:rgba(255,255,255,.35);background:rgba(255,255,255,.07);transform:scale(1.06)}
.g-row{display:flex;gap:8px}
.g-opt{flex:1;background:var(--sf);border:1px solid var(--ln);border-radius:12px;padding:10px 4px;text-align:center;cursor:pointer;transition:all .2s}
.g-opt.on{border-color:rgba(200,240,80,.35);background:rgba(200,240,80,.07)}
.g-opt span:first-child{font-family:var(--fd);font-style:italic;font-size:18px;display:block}
.g-opt span:last-child{font-size:8px;font-weight:200;color:var(--dim)}
.join-inp{width:100%;background:var(--sf);border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:14px 16px;font-family:var(--fb);font-size:16px;font-weight:300;color:var(--hi);letter-spacing:.1em;outline:none;transition:border-color .2s;caret-color:var(--acc);margin-bottom:12px;text-transform:uppercase}
.join-inp::placeholder{color:rgba(255,255,255,.2);text-transform:none}
.join-inp:focus{border-color:rgba(200,240,80,.4)}
.join-prev{display:none;align-items:center;gap:12px;background:rgba(200,240,80,.05);border:1px solid rgba(200,240,80,.18);border-radius:14px;padding:14px 16px;margin-bottom:14px}
.join-prev.on{display:flex}
/* member modal */
.mm-hd{display:flex;align-items:center;gap:12px;padding:22px 20px 16px;border-bottom:1px solid var(--ln)}
.mm-em{font-size:32px}.mm-name{font-family:var(--fd);font-style:italic;font-size:22px;font-weight:300}.mm-cl{font-size:11px;font-weight:200;color:var(--dim);margin-top:2px}
.mm-rank{font-family:var(--fd);font-style:italic;font-size:28px;font-weight:300;margin-left:auto}
.mm-rank.g{color:var(--gold)}.mm-rank.s{color:var(--silver)}.mm-rank.b{color:var(--bronze)}.mm-rank.o{color:var(--acc)}
.mm-stats{display:flex;padding:16px 20px;border-bottom:1px solid var(--ln)}
.mm-st{flex:1;display:flex;flex-direction:column;gap:2px}
.mm-st+.mm-st{border-left:1px solid var(--ln);padding-left:14px}
.mm-sl{font-size:8px;font-weight:200;letter-spacing:.1em;color:var(--dim)}.mm-sv{font-family:var(--fd);font-style:italic;font-size:22px;font-weight:300}
.mm-rl{padding:14px 20px 8px;font-size:9px;letter-spacing:.12em;color:var(--dim)}
.mm-rr{display:flex;align-items:center;gap:10px;padding:10px 20px;border-bottom:1px solid var(--ln)}
.mm-rd{font-size:9px;color:var(--dim);width:44px;flex-shrink:0}.mm-rk{font-family:var(--fd);font-style:italic;font-size:17px;flex:1}.mm-rp{font-size:10px;color:var(--dim)}
.mm-close{width:calc(100% - 40px);margin:14px 20px 0;background:none;border:1px solid var(--ln);border-radius:14px;padding:12px;font-family:var(--fb);font-size:12px;color:var(--dim);cursor:pointer}
/* avatar */
#avs{position:fixed;inset:0;z-index:90;display:flex;align-items:flex-end;justify-content:center;background:rgba(0,0,0,.55);backdrop-filter:blur(12px);opacity:0;pointer-events:none;transition:opacity .28s}
#avs.on{opacity:1;pointer-events:all}
.av-box{width:100%;max-width:430px;background:#111114;border:1px solid var(--ln);border-bottom:none;border-radius:20px 20px 0 0;padding:16px 18px 36px;transform:translateY(12px);transition:transform .3s}
#avs.on .av-box{transform:translateY(0)}
.av-ttl{font-size:9px;letter-spacing:.14em;color:var(--dim);text-align:center;margin-bottom:12px}
.av-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:7px}
.avc{display:flex;flex-direction:column;align-items:center;gap:3px;padding:9px 3px 7px;border-radius:11px;border:1px solid transparent;background:var(--sf);cursor:pointer;transition:all .2s}
.avc.on{border-color:rgba(255,255,255,.22);background:rgba(255,255,255,.06)}
.ave{font-size:22px;line-height:1}.avl{font-size:8px;font-weight:200;color:var(--dim)}.avc.on .avl{color:var(--hi)}
/* toast/flash */
#toast{position:fixed;z-index:200;bottom:74px;left:50%;transform:translateX(-50%) translateY(5px);background:rgba(10,10,13,.96);border:1px solid rgba(255,255,255,.08);border-radius:99px;padding:8px 18px;font-size:11px;color:var(--mid);opacity:0;transition:opacity .25s,transform .25s;pointer-events:none;white-space:nowrap}
#toast.on{opacity:1;transform:translateX(-50%) translateY(0)}
#flash{position:fixed;inset:0;z-index:300;background:rgba(255,255,255,.1);opacity:0;pointer-events:none;transition:opacity .08s}
#flash.on{opacity:1}
input[type=file]{display:none}

/* ‚ïê‚ïê LOGIN SCREEN ‚ïê‚ïê */
#login-screen{position:fixed;inset:0;z-index:998;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:32px 28px;transition:opacity .5s,transform .5s}
#login-screen.out{opacity:0;transform:scale(1.04);pointer-events:none}
.ls-logo{font-family:var(--fd);font-style:italic;font-size:36px;font-weight:300;margin-bottom:6px;text-align:center}
.ls-sub{font-size:11px;font-weight:200;color:var(--dim);text-align:center;letter-spacing:.06em;margin-bottom:36px}
.ls-form{width:100%;display:flex;flex-direction:column;gap:10px;margin-bottom:14px}
.ls-input{width:100%;background:var(--sf);border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:14px 16px;font-family:var(--fb);font-size:14px;font-weight:200;color:var(--hi);outline:none;caret-color:var(--acc);transition:border-color .2s}
.ls-input:focus{border-color:rgba(200,240,80,.4)}
.ls-input::placeholder{color:rgba(255,255,255,.2)}
.ls-btn{width:100%;background:var(--acc);border:none;border-radius:14px;padding:16px;font-family:var(--fb);font-size:14px;font-weight:400;color:var(--bg);cursor:pointer;transition:opacity .2s;letter-spacing:.03em}
.ls-btn:active{opacity:.85}
.ls-err{font-size:11px;font-weight:200;color:rgba(255,100,100,.8);text-align:center;min-height:16px;margin-top:-2px}
.ls-switch{font-size:11px;font-weight:200;color:var(--dim);text-align:center;cursor:pointer;margin-top:4px}
.ls-switch span{color:var(--acc);opacity:.85;text-decoration:underline;text-underline-offset:2px}
.ls-divider{display:flex;align-items:center;gap:10px;margin:14px 0}
.ls-divider::before,.ls-divider::after{content:'';flex:1;height:1px;background:var(--ln)}
.ls-divider span{font-size:10px;font-weight:200;color:rgba(255,255,255,.2)}
.ls-social{display:flex;gap:10px;width:100%}
.ls-social-btn{flex:1;background:var(--sf);border:1px solid var(--ln);border-radius:12px;padding:12px 8px;display:flex;align-items:center;justify-content:center;gap:8px;cursor:pointer;font-family:var(--fb);font-size:12px;font-weight:200;color:var(--mid);transition:all .2s}
.ls-social-btn:active{background:var(--sf2)}
.ls-social-em{font-size:16px}
.ls-mode-title{font-family:var(--fd);font-style:italic;font-size:22px;font-weight:300;margin-bottom:4px;align-self:flex-start}
.ls-mode-sub{font-size:11px;font-weight:200;color:var(--dim);margin-bottom:28px;align-self:flex-start}
/* profile badge in nav */
#nav-profile{width:28px;height:28px;border-radius:50%;background:var(--sf2);border:1px solid rgba(200,240,80,.3);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;transition:all .2s}
#nav-profile:active{transform:scale(.9)}
/* user profile modal */
.prof-hd{padding:22px 20px 16px;border-bottom:1px solid var(--ln);display:flex;align-items:center;gap:14px}
.prof-avatar{width:52px;height:52px;border-radius:50%;background:var(--sf2);border:1px solid rgba(200,240,80,.25);display:flex;align-items:center;justify-content:center;font-size:26px;flex-shrink:0}
.prof-name{font-family:var(--fd);font-style:italic;font-size:20px;font-weight:300}
.prof-email{font-size:10px;font-weight:200;color:var(--dim);margin-top:2px}
.prof-joined{font-size:9px;font-weight:200;color:rgba(200,240,80,.6);margin-top:3px}
.prof-stats-row{display:flex;padding:16px 20px;border-bottom:1px solid var(--ln)}
.prof-st{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px}
.prof-st+.prof-st{border-left:1px solid var(--ln)}
.prof-sl{font-size:8px;font-weight:200;letter-spacing:.1em;color:var(--dim)}
.prof-sv{font-family:var(--fd);font-style:italic;font-size:22px;font-weight:300}
.prof-menu-item{display:flex;align-items:center;gap:12px;padding:14px 20px;border-bottom:1px solid var(--ln);cursor:pointer;transition:background .15s}
.prof-menu-item:active{background:rgba(255,255,255,.03)}
.prof-menu-em{font-size:16px;width:22px;text-align:center}
.prof-menu-txt{flex:1;font-size:13px;font-weight:200}
.prof-menu-arrow{font-size:11px;color:var(--dim)}
.prof-logout{width:calc(100% - 40px);margin:14px 20px;background:rgba(255,70,70,.08);border:1px solid rgba(255,70,70,.18);border-radius:14px;padding:13px;font-family:var(--fb);font-size:13px;font-weight:300;color:rgba(255,110,110,.85);cursor:pointer;transition:all .2s}
.prof-logout:active{background:rgba(255,70,70,.15)}
/* server status badge */
.srv-badge{position:fixed;top:56px;right:10px;z-index:80;display:flex;align-items:center;gap:5px;background:rgba(10,10,13,.88);border:1px solid var(--ln);border-radius:99px;padding:4px 10px;font-size:9px;font-weight:200;color:var(--dim);backdrop-filter:blur(8px);pointer-events:none;transition:opacity .3s}
.srv-dot{width:6px;height:6px;border-radius:50%;background:var(--dim);flex-shrink:0}
.srv-badge.online .srv-dot{background:var(--acc);box-shadow:0 0 5px rgba(200,240,80,.5)}
.srv-badge.online{color:rgba(200,240,80,.7);border-color:rgba(200,240,80,.15)}
</style>
</head>
<body>

<!-- SPLASH -->
<div id="splash">
  <div class="sp-grain"></div><div class="sp-glow"></div><div class="sp-lines"></div>
  <div class="sp-em">üëª</div>
  <div class="sp-logo">GhostRun</div>
  <div class="sp-sub">Ïö∞Î¶¨Îäî Ìï®Íªò Îã¨Î¶¨Í≥† ÏûàÏäµÎãàÎã§.</div>
  <div class="sp-desc">ÎäêÏä®Ìïú Ïó∞ÎåÄÎ•º ÏúÑÌïú<br>ÎπÑÎåÄÎ©¥ Îß§Ïπ≠ ÌîåÎû´Ìèº</div>
  <button class="sp-btn" onclick="hideSplash()">ÏãúÏûëÌïòÍ∏∞</button>
  <span class="sp-ver">v2.0 ¬∑ 2025</span>
</div>

<!-- LOGIN SCREEN -->
<div id="login-screen" style="display:none">
  <div class="ls-logo">üëª GhostRun</div>
  <div class="ls-sub" id="ls-sub-txt">Ìï®Íªò Îã¨Î¶¨Îäî ÏÇ¨ÎûåÎì§</div>
  <div class="ls-mode-title" id="ls-mode-title">Î°úÍ∑∏Ïù∏</div>
  <div class="ls-mode-sub" id="ls-mode-sub">Í≥ÑÏÜçÌïòÎ†§Î©¥ Î°úÍ∑∏Ïù∏ÌïòÏÑ∏Ïöî</div>
  <div class="ls-form">
    <input class="ls-input" id="ls-email" type="email" placeholder="Ïù¥Î©îÏùº" autocomplete="email">
    <input class="ls-input" id="ls-pw" type="password" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏" autocomplete="current-password">
    <input class="ls-input" id="ls-nick" type="text" placeholder="ÎãâÎÑ§ÏûÑ (ÌöåÏõêÍ∞ÄÏûÖ Ïãú)" style="display:none" autocomplete="nickname" maxlength="12">
    <div class="ls-err" id="ls-err"></div>
    <button class="ls-btn" id="ls-submit" onclick="submitAuth()">Î°úÍ∑∏Ïù∏</button>
  </div>
  <div class="ls-switch" id="ls-switch" onclick="toggleAuthMode()">Í≥ÑÏ†ïÏù¥ ÏóÜÏúºÏã†Í∞ÄÏöî? <span>ÌöåÏõêÍ∞ÄÏûÖ</span></div>
  <div class="ls-divider"><span>ÎòêÎäî</span></div>
  <div class="ls-social">
    <button class="ls-social-btn" onclick="socialLogin('kakao')"><span class="ls-social-em">üíõ</span>Ïπ¥Ïπ¥Ïò§</button>
    <button class="ls-social-btn" onclick="socialLogin('naver')"><span class="ls-social-em">üü¢</span>ÎÑ§Ïù¥Î≤Ñ</button>
    <button class="ls-social-btn" onclick="socialLogin('google')"><span class="ls-social-em">üîµ</span>Íµ¨Í∏Ä</button>
  </div>
</div>

<!-- SERVER STATUS -->
<div class="srv-badge" id="srv-badge"><div class="srv-dot"></div><span id="srv-txt">ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ï§ë...</span></div>

<!-- PROFILE MODAL -->
<div id="m-profile" class="modal"><div class="m-box" id="prof-box"></div></div>

<div id="nav"><span class="logo">GhostRun</span><div style="display:flex;align-items:center;gap:10px"><span id="clock"></span><div id="nav-profile" onclick="openProfile()" title="ÌîÑÎ°úÌïÑ">üë§</div></div></div>

<div id="main">

<!-- HOME -->
<div id="v-home" class="mview on">
  <div class="hm-hero">
    <div class="hm-hero-bg"></div><div class="hm-hero-pattern"></div><div class="hm-hero-glow"></div>
    <div class="hm-hero-inner">
      <div class="hm-tag" id="hm-tag">2025ÎÖÑ 2Ïõî</div>
      <div class="hm-hero-title">Îî∞Î°ú Îòê Í∞ôÏù¥<br>Îã¨Î¶¨Îäî ÏÇ¨ÎûåÎì§</div>
      <div class="hm-hero-sub">ÎßàÌè¨Íµ¨ ¬∑ Ïú†Î†π ÌÅ¨Î£® ¬∑ 3Îì±</div>
      <div class="hm-hero-stats">
        <div class="hm-hs"><span class="hm-hsv">5.2</span><span class="hm-hsl">Ïù¥Î≤à Îü∞</span></div>
        <div class="hm-hs"><span class="hm-hsv">37.8</span><span class="hm-hsl">Ïù¥Î≤à Îã¨</span></div>
        <div class="hm-hs"><span class="hm-hsv">38%</span><span class="hm-hsl">ÌÅ¨Î£® Î™©Ìëú</span></div>
      </div>
    </div>
  </div>
  <div class="hm-today">
    <div class="hm-today-hd">
      <span class="hm-today-lbl">Ïò§ÎäòÏùò Îü¨Îãù</span>
      <button class="hm-today-btn" onclick="goTab('run')">ÏãúÏûë ‚Üí</button>
    </div>
    <div class="hm-today-row">
      <div class="hm-ts"><span class="hm-tsl">Ïù¥Î≤à Îã¨</span><span class="hm-tsv">5.2<span style="font-size:13px;color:var(--dim)"> km</span></span></div>
      <div class="hm-ts"><span class="hm-tsl">ÌéòÏù¥Ïä§</span><span class="hm-tsv" style="font-size:20px">5'12"</span></div>
      <div class="hm-ts"><span class="hm-tsl">ÌÅ¨Î£® ÏàúÏúÑ</span><span class="hm-tsv" style="color:var(--bronze)">3Îì±</span></div>
    </div>
  </div>
  <div class="hm-sec">
    <div class="hm-sec-hd"><span class="hm-sec-title">ÌÅ¨Î£® ÌòÑÌô©</span><span class="hm-sec-more" onclick="goTab('crew')">ÎçîÎ≥¥Í∏∞</span></div>
    <div id="hm-crew"></div>
  </div>
  <div class="hm-sec">
    <div class="hm-sec-hd"><span class="hm-sec-title">Îü¨Îãù Îß§Í±∞ÏßÑ</span><span class="hm-sec-more">Ï†ÑÏ≤¥Î≥¥Í∏∞</span></div>
    <div class="hm-feat">
      <div class="hm-feat-img"><div class="hm-feat-glow"></div><span class="hm-feat-em">üåô</span></div>
      <div class="hm-feat-body">
        <div class="hm-feat-tag">FEATURE ¬∑ Ïù¥Îã¨Ïùò Ïª§Î≤Ñ</div>
        <div class="hm-feat-title">ÏÉàÎ≤Ω Îü¨ÎãùÏù¥ ÎáåÏóê ÎØ∏ÏπòÎäî ÏòÅÌñ•, Í≥ºÌïôÏúºÎ°ú Ï¶ùÎ™ÖÎêú 5Í∞ÄÏßÄ</div>
        <div class="hm-feat-desc">ÏΩîÎ•¥Ìã∞ÏÜîÏù¥ Í∞ÄÏû• ÎÇÆÏùÄ ÏãúÍ∞ÑÎåÄÏóê Îã¨Î¶¨Î©¥ ÏßëÏ§ëÎ†•Ïù¥ Îã¨ÎùºÏßÑÎã§. ÏÉàÎ≤Ω Îü¨ÎãùÏùò Ïã†Í≤ΩÍ≥ºÌïôÏ†Å Ïù¥Ï†êÏùÑ ÏïåÏïÑÎ≥∏Îã§.</div>
        <div class="hm-feat-foot"><span class="hm-feat-by">GhostRun ÏóêÎîîÌÑ∞ ¬∑ 5Î∂Ñ</span><span class="hm-feat-cta">ÏùΩÍ∏∞ ‚Üí</span></div>
      </div>
    </div>
    <div class="hm-grid">
      <div class="hm-card"><div class="hm-card-top"><div class="hm-card-glow"></div>üèÉ</div><div class="hm-card-body"><div class="hm-card-tag">TRAINING</div><div class="hm-card-title">5km Ï≤òÏùå Îã¨ÏÑ±ÌïòÎäî Í∞ÄÏû• Îπ†Î•∏ Î∞©Î≤ï</div><div class="hm-card-time">3Î∂Ñ</div></div></div>
      <div class="hm-card"><div class="hm-card-top"><div class="hm-card-glow"></div>üå°</div><div class="hm-card-body"><div class="hm-card-tag">GEAR</div><div class="hm-card-title">Í≤®Ïö∏ Îü¨Îãù, Î†àÏù¥Ïñ¥ÎßÅÏùò Ï†ïÏÑù</div><div class="hm-card-time">4Î∂Ñ</div></div></div>
      <div class="hm-card"><div class="hm-card-top"><div class="hm-card-glow"></div>üßò</div><div class="hm-card-body"><div class="hm-card-tag">RECOVERY</div><div class="hm-card-title">Îã¨Î¶¨Í≥† ÎÇú ÌõÑ, Ïä§Ìä∏Î†àÏπ≠ Î£®Ìã¥</div><div class="hm-card-time">2Î∂Ñ</div></div></div>
      <div class="hm-card"><div class="hm-card-top"><div class="hm-card-glow"></div>üéµ</div><div class="hm-card-body"><div class="hm-card-tag">PLAYLIST</div><div class="hm-card-title">BPM 170, ÌéòÏù¥Ïä§Î•º ÎÜíÏù¥Îäî Í≥°Îì§</div><div class="hm-card-time">ÌÅêÎ†àÏù¥ÏÖò</div></div></div>
    </div>
  </div>
  <div style="height:32px"></div>
</div>

<!-- RUN -->
<div id="v-run" class="mview">
  <!-- SETUP -->
  <div id="rsetup" class="rstate on">
    <div class="rs-top"><div class="rs-title">Îü¨Îãù ÏãúÏûë</div><div class="rs-sub">Î™©ÌëúÎ•º ÏÑ§Ï†ïÌïòÍ≥† Îã¨Î†§Î≥¥ÏÑ∏Ïöî</div></div>
    <div id="map-wrap">
      <div id="gmap"></div>
      <div class="map-ph" id="map-ph"><span class="map-ph-em">üó∫</span><span class="map-ph-txt">ÏúÑÏπò Í∂åÌïúÏùÑ ÌóàÏö©ÌïòÎ©¥<br>ÏßÄÎèÑÍ∞Ä ÌëúÏãúÎê©ÎãàÎã§</span></div>
      <button class="loc-btn" id="loc-btn" onclick="reqLoc()"><div class="loc-dot" id="loc-dot"></div><span id="loc-txt">ÎÇ¥ ÏúÑÏπò ÌóàÏö©</span></button>
    </div>
    <div class="rs-body">
      <div class="rs-lbl">Î™©Ìëú Ïú†Ìòï</div>
      <div class="gt-row">
        <div class="gt on" data-gt="dist"><div class="gt-em">üìç</div><div class="gt-nm">Í±∞Î¶¨</div></div>
        <div class="gt" data-gt="time"><div class="gt-em">‚è±</div><div class="gt-nm">ÏãúÍ∞Ñ</div></div>
        <div class="gt" data-gt="speed"><div class="gt-em">‚ö°</div><div class="gt-nm">ÌéòÏù¥Ïä§</div></div>
        <div class="gt" data-gt="free"><div class="gt-em">üåô</div><div class="gt-nm">ÏûêÏú†</div></div>
      </div>
      <div class="rs-lbl" id="gvlbl">Î™©Ìëú Í±∞Î¶¨</div>
      <div class="gv-grid" id="gvd">
        <div class="gv" data-v="3"><span class="gv-n">3</span><span class="gv-u">km</span></div>
        <div class="gv on" data-v="5"><span class="gv-n">5</span><span class="gv-u">km</span></div>
        <div class="gv" data-v="10"><span class="gv-n">10</span><span class="gv-u">km</span></div>
        <div class="gv" data-v="15"><span class="gv-n">15</span><span class="gv-u">km</span></div>
        <div class="gv" data-v="21"><span class="gv-n">21</span><span class="gv-u">km</span></div>
        <div class="gv" data-v="42"><span class="gv-n">42</span><span class="gv-u">km</span></div>
      </div>
      <div class="gv-grid" id="gvt" style="display:none">
        <div class="gv" data-v="20"><span class="gv-n">20</span><span class="gv-u">Î∂Ñ</span></div>
        <div class="gv on" data-v="30"><span class="gv-n">30</span><span class="gv-u">Î∂Ñ</span></div>
        <div class="gv" data-v="45"><span class="gv-n">45</span><span class="gv-u">Î∂Ñ</span></div>
        <div class="gv" data-v="60"><span class="gv-n">60</span><span class="gv-u">Î∂Ñ</span></div>
        <div class="gv" data-v="90"><span class="gv-n">90</span><span class="gv-u">Î∂Ñ</span></div>
        <div class="gv" data-v="120"><span class="gv-n">120</span><span class="gv-u">Î∂Ñ</span></div>
      </div>
      <div class="gv-grid" id="gvs" style="display:none">
        <div class="gv" data-v="430"><span class="gv-n">4'30"</span><span class="gv-u">/km</span></div>
        <div class="gv on" data-v="500"><span class="gv-n">5'00"</span><span class="gv-u">/km</span></div>
        <div class="gv" data-v="530"><span class="gv-n">5'30"</span><span class="gv-u">/km</span></div>
        <div class="gv" data-v="600"><span class="gv-n">6'00"</span><span class="gv-u">/km</span></div>
        <div class="gv" data-v="630"><span class="gv-n">6'30"</span><span class="gv-u">/km</span></div>
        <div class="gv" data-v="700"><span class="gv-n">7'00"</span><span class="gv-u">/km</span></div>
      </div>
    </div>
    <button class="rs-start" onclick="startRun()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="5 3 19 12 5 21 5 3"/></svg>
      Îã¨Î¶¨Í∏∞ ÏãúÏûë
    </button>
  </div>
  <!-- ACTIVE -->
  <div id="ractive" class="rstate">
    <div class="ra-map-big">
      <div id="gmap-active"></div>
      <div class="ra-map-ph" id="ra-ph"><span style="font-size:40px;opacity:.25">üèÉ</span><span style="font-size:12px;font-weight:200;color:var(--dim)">Îã¨Î¶¨Îäî Ï§ë...</span></div>
    </div>
    <div class="ra-stats">
      <div class="ra-st"><span class="ra-sl">Í±∞Î¶¨</span><span class="ra-sv" id="ra-dist">0.00</span><span class="ra-su">km</span></div>
      <div class="ra-st"><span class="ra-sl">ÌéòÏù¥Ïä§</span><span class="ra-sv" id="ra-pace">--'--"</span><span class="ra-su">/km</span></div>
      <div class="ra-st"><span class="ra-sl">ÏãúÍ∞Ñ</span><span class="ra-sv" id="ra-time">00:00</span><span class="ra-su"></span></div>
      <div class="ra-st"><span class="ra-sl">ÏπºÎ°úÎ¶¨</span><span class="ra-sv" id="ra-cal">0</span><span class="ra-su">kcal</span></div>
    </div>
    <div class="ra-goal">
      <div class="ra-gl"><span id="ra-gl-txt">Î™©Ìëú 5km</span><span id="ra-pct-txt" style="color:var(--acc)">0%</span></div>
      <div class="ra-bar"><div class="ra-fill" id="ra-fill" style="width:0%"></div></div>
    </div>
    <div class="ra-ctrl">
      <button class="ra-stop" onclick="stopRun()">üèÅ Îü¨Îãù Ï¢ÖÎ£å</button>
      <button class="ra-pause" id="pause-btn" onclick="togglePause()">
        <svg id="pause-ico" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--mid)" stroke-width="2" stroke-linecap="round"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
      </button>
    </div>
  </div>
  <!-- FINISH -->
  <div id="rfinish" class="rstate">
    <div class="rf-top"><div class="rf-em">üèÖ</div><div class="rf-title">ÏôÑÏ£º!</div><div class="rf-msg" id="rf-msg">Ïò§ÎäòÎèÑ Ïûò Îã¨Î†∏Ïñ¥Ïöî</div></div>
    <div class="rf-grid">
      <div class="rf-cell"><span class="rf-cl">Í±∞Î¶¨</span><span class="rf-cv" id="rf-d">0.00</span><span class="rf-cu">km</span></div>
      <div class="rf-cell"><span class="rf-cl">ÏãúÍ∞Ñ</span><span class="rf-cv" id="rf-t">00:00</span><span class="rf-cu"></span></div>
      <div class="rf-cell"><span class="rf-cl">ÌèâÍ∑† ÌéòÏù¥Ïä§</span><span class="rf-cv" id="rf-p">--'--"</span><span class="rf-cu">/km</span></div>
      <div class="rf-cell"><span class="rf-cl">ÏπºÎ°úÎ¶¨</span><span class="rf-cv" id="rf-c">0</span><span class="rf-cu">kcal</span></div>
    </div>
    <div class="rf-acts">
      <button class="rf-shot" onclick="goTab('shot')">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
        Ïù∏Ï¶ùÏÉ∑ Ï∞çÍ∏∞
      </button>
      <button class="rf-done" onclick="resetRun()">ÏôÑÎ£å</button>
    </div>
  </div>
</div>

<!-- CREW -->
<div id="v-crew" class="mview">
  <div id="no-crew">
    <div class="nc-em">üëª</div>
    <div class="nc-title">ÏïÑÏßÅ ÌÅ¨Î£®Í∞Ä ÏóÜÏñ¥Ïöî</div>
    <div class="nc-sub">ÌÅ¨Î£®Ïóê Ï∞∏Ïó¨ÌïòÎ©¥ Ìï®Íªò Îã¨Î¶¨Í≥†<br>ÏÑúÎ°úÏùò Í∏∞Î°ùÏùÑ Î≥º Ïàò ÏûàÏñ¥Ïöî</div>
    <div class="nc-actions">
      <button class="nc-primary" onclick="openModal('m-join')"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>Ï¥àÎåÄ ÏΩîÎìúÎ°ú Ï∞∏Ïó¨</button>
      <div class="nc-divider"><span>ÎòêÎäî</span></div>
      <div class="nc-nearby">
        <div class="nc-nl">üìç ÎÇ¥ Í∑ºÏ≤ò ÌÅ¨Î£®</div>
        <div class="nc-nr"><span class="nc-nem">üßõ</span><div class="nc-ni"><div class="nc-nn">ÎìúÎùºÌÅòÎùº ÌÅ¨Î£®</div><div class="nc-nm">ÎßàÌè¨Íµ¨ ¬∑ 8Î™Ö ¬∑ #GR-1138</div></div><span class="nc-npct">62%</span><button class="nc-njoin" onclick="quickJoin('ÎìúÎùºÌÅòÎùº ÌÅ¨Î£®','üßõ')">Ï∞∏Ïó¨</button></div>
        <div class="nc-nr"><span class="nc-nem">üßü</span><div class="nc-ni"><div class="nc-nn">Ï¢ÄÎπÑ ÌÅ¨Î£®</div><div class="nc-nm">ÎßàÌè¨Íµ¨ ¬∑ 6Î™Ö ¬∑ #GR-0442</div></div><span class="nc-npct">65%</span><button class="nc-njoin" onclick="quickJoin('Ï¢ÄÎπÑ ÌÅ¨Î£®','üßü')">Ï∞∏Ïó¨</button></div>
        <div class="nc-nr"><span class="nc-nem">üéÉ</span><div class="nc-ni"><div class="nc-nn">Ìò∏Î∞ï ÌÅ¨Î£®</div><div class="nc-nm">ÎßàÌè¨Íµ¨ ¬∑ 5Î™Ö ¬∑ #GR-3391</div></div><span class="nc-npct">48%</span><button class="nc-njoin" onclick="quickJoin('Ìò∏Î∞ï ÌÅ¨Î£®','üéÉ')">Ï∞∏Ïó¨</button></div>
      </div>
      <div class="nc-divider"><span>ÏßÅÏ†ë ÎßåÎì§Í∏∞</span></div>
      <button class="nc-sec" onclick="openModal('m-create')"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>ÏÉà ÌÅ¨Î£® ÎßåÎì§Í∏∞</button>
    </div>
  </div>
  <div id="crew-content" style="display:none;flex-direction:column;flex:1;overflow:hidden">
    <div id="ctabs">
      <button class="ctab on" data-c="my">ÎÇ¥ ÌÅ¨Î£®</button>
      <button class="ctab" data-c="near">ÌÅ¨Î£® Îû≠ÌÇπ</button>
      <button class="ctab" data-c="past">Î™®ÏïÑÎ≥¥Í∏∞</button>
    </div>
    <div class="cpane on" id="cp-my">
      <div class="crew-hdr">
        <div><div class="crew-hdr-name" id="ch-name">üëª Ïú†Î†π ÌÅ¨Î£®</div><div class="crew-hdr-sub" id="ch-sub">#GR-2847 ¬∑ 2Ïõî ¬∑ 8Î™Ö</div><div class="crew-hdr-loc">üìç ÎßàÌè¨Íµ¨ ¬∑ ÏÑúÏö∏</div></div>
        <div class="crew-expert">‚≠ê Expert</div>
      </div>
      <div class="gc-card">
        <div class="gc-top"><div><div class="gc-lbl">ÌÅ¨Î£® Î™©Ìëú</div><div class="gc-nums"><span class="gc-cur" id="gcc">37.8</span><span class="gc-sep"> / </span><span class="gc-tot">100</span><span class="gc-unit">km</span></div></div><span class="gc-pct" id="gcp">38%</span></div>
        <div class="prog"><div class="pf" id="gcpf" style="width:0%"><div class="pd"></div></div></div>
        <div class="gc-meta">
          <div class="gm"><span class="gm-l">Ïù∏Ïõê</span><span class="gm-v" id="gcm1"></span></div>
          <div class="gm"><span class="gm-l">ÎÇ¥ Í∏∞Ïó¨</span><span class="gm-v a" id="gcm2"></span></div>
          <div class="gm"><span class="gm-l">1ÏúÑÍπåÏßÄ</span><span class="gm-v" id="gcm3"></span></div>
          <div class="gm"><span class="gm-l">ÎÇ®ÏùÄ Î™©Ìëú</span><span class="gm-v" id="gcm4"></span></div>
        </div>
      </div>
      <div class="lb-hdr"><span class="lb-ttl">ÌÅ¨Î£® ÏàúÏúÑ</span><span class="lb-cnt" id="lbcnt"></span></div>
      <div id="crew-lb"></div>
    </div>
    <div class="cpane" id="cp-near"><div class="nb-hdr"><div class="nb-area">ÎßàÌè¨Íµ¨ ÌÅ¨Î£® Îû≠ÌÇπ</div><div class="nb-desc">ÎÇ¥ ÏúÑÏπò Í∏∞Ï§Ä ¬∑ Î∞òÍ≤Ω 5km</div></div><div id="nearby-list"></div></div>
    <div class="cpane" id="cp-past"><div class="past-hdr"><span class="past-title">ÎÇ¥ ÌÅ¨Î£® ÌûàÏä§ÌÜ†Î¶¨</span><button class="expert-btn" onclick="openModal('m-expert')"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>Expert</button></div><div id="past-list"></div></div>
  </div>
</div>

<!-- SHOT -->
<div id="v-shot" class="mview">
  <div id="card">
    <img id="bg-img" src="" alt="">
    <div id="empty-state"><div class="e-grain"></div><div class="e-icon">üåô</div><div class="e-hint">ÏÇ¨ÏßÑÏùÑ Î∂àÎü¨Ïò§ÏÑ∏Ïöî</div></div>
    <div id="ovs">
      <div class="ov" id="ov-g">
        <div class="ft"></div><div class="fb"></div>
        <div class="ov-hd">
          <div class="runner" onclick="openAv()"><span class="r-em" id="em-g">üëª</span><span class="r-nm" id="nm-g">Ïú†Î†π3</span></div>
          <div class="ov-dt" id="dt-g"></div>
        </div>
        <div class="chip gchip"><span class="ch-n" id="cn-g"></span><span class="ch-of" id="co-g"></span></div>
        <div class="gboard" id="gboard"><div class="gb-lbl">ÌÅ¨Î£® ÏàúÏúÑ</div></div>
        <div class="g-bot">
          <div class="g-dist">5.20<span class="g-du">km</span></div>
          <div class="g-stats">
            <div class="g-s"><span class="g-sl">Pace</span><span class="g-sv">5'12"</span></div>
            <div class="g-s"><span class="g-sl">Time</span><span class="g-sv">26'58"</span></div>
            <div class="g-s"><span class="g-sl">Cal</span><span class="g-sv">312</span></div>
          </div>
          <div class="g-foot"><span class="g-brand">GhostRun ¬∑ Îî∞Î°ú Îòê Í∞ôÏù¥</span><span class="g-tag"># Ghost</span></div>
        </div>
        <canvas id="mmg" width="40" height="40"></canvas>
      </div>
      <div class="ov off" id="ov-p">
        <div class="ft"></div>
        <div style="position:absolute;bottom:0;left:0;right:0;height:190px;background:linear-gradient(0deg,rgba(0,0,0,.9),rgba(0,0,0,.4) 55%,transparent)"></div>
        <div class="ov-hd"><div class="runner" onclick="openAv()"><span class="r-em" id="em-p">üëª</span><span class="r-nm" id="nm-p">Ïú†Î†π3</span></div><span class="p-logo">GhostRun</span></div>
        <div class="p-mapbg"><canvas id="mmp" width="220" height="220"></canvas></div>
        <div class="chip p-chip"><span class="ch-n" id="cn-p"></span><span style="font-size:9px;color:rgba(255,255,255,.28)">Îì±</span><span class="ch-of" id="co-p"></span></div>
        <div class="p-bot">
          <div class="p-stat"><span class="p-l">Distance</span><span class="p-v">5.20<span class="p-u"> km</span></span></div>
          <div class="p-stat" style="text-align:right"><span class="p-l" style="text-align:right">Avg Pace</span><span class="p-v">5'12"<span class="p-u">/km</span></span></div>
        </div>
      </div>
      <div class="ov off" id="ov-s">
        <div class="st-vign"></div>
        <div style="position:absolute;bottom:0;left:0;right:0;height:270px;background:linear-gradient(0deg,rgba(0,0,0,.9),transparent)"></div>
        <div class="ov-hd" style="background:linear-gradient(180deg,rgba(0,0,0,.5),transparent);padding-bottom:10px"><div class="runner" onclick="openAv()"><span class="r-em" id="em-s">üëª</span><span class="r-nm" id="nm-s">Ïú†Î†π3</span></div><span class="st-logo">GhostRun</span></div>
        <div class="st-bot">
          <div class="st-rrow"><span class="st-rn" id="st-rn">3Îì±</span><span class="st-of" id="st-of">/ 8Î™Ö</span></div>
          <div class="st-dist">5.20<span class="st-du">km</span></div>
          <div class="st-sub"><div class="ss"><span class="ss-l">Pace</span><span class="ss-v">5'12"</span></div><div class="ss"><span class="ss-l">Time</span><span class="ss-v">26'58"</span></div><div class="ss"><span class="ss-l">Cal</span><span class="ss-v">312</span></div></div>
        </div>
        <div class="st-badge"><span class="sb-em" id="em-b">üëª</span><span class="sb-done">Completed</span><span class="sb-date" id="bd"></span></div>
        <canvas id="mms" width="40" height="40"></canvas>
      </div>
    </div>
  </div>
  <div id="tbar">
    <button class="th on" data-t="g">üëª Ghost</button>
    <button class="th" data-t="p">üó∫ Path</button>
    <button class="th" data-t="s">üéñ Stamp</button>
  </div>
  <div id="shot-acts">
    <label class="ai"><input type="file" id="ic" accept="image/*" capture="environment"><svg viewBox="0 0 24 24"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg></label>
    <label class="ai"><input type="file" id="ig" accept="image/*"><svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg></label>
    <button class="asave" id="bsave"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>Ï†ÄÏû•ÌïòÍ∏∞</button>
  </div>
</div>

<!-- RECORDS -->
<div id="v-records" class="mview">
  <div class="rec-hero">
    <div class="rec-hero-lbl">Ï¥ù ÎàÑÏ†Å Í±∞Î¶¨</div>
    <div class="rec-big"><span class="rec-big-n">312</span><span class="rec-big-u">.4 km</span></div>
    <div class="rec-hero-sub">62Ìöå ÏôÑÏ£º ¬∑ Îü¨Îãù 47ÏãúÍ∞Ñ 28Î∂Ñ</div>
    <div class="rec-3">
      <div class="rec-3s"><span class="rec-3sl">Ï¥ù ÏãúÍ∞Ñ</span><span class="rec-3sv">47<span style="font-family:var(--fb);font-size:16px;color:var(--dim)">h</span></span><span class="rec-3su">28Î∂Ñ</span></div>
      <div class="rec-3s"><span class="rec-3sl">ÌèâÍ∑† ÌéòÏù¥Ïä§</span><span class="rec-3sv">5'18"</span><span class="rec-3su">/km</span></div>
      <div class="rec-3s"><span class="rec-3sl">Ï∞∏Ïó¨ ÌÅ¨Î£®</span><span class="rec-3sv">5</span><span class="rec-3su">Í∞ú</span></div>
    </div>
  </div>
  <div class="rec-cal"><div class="rec-cal-lbl">Ïù¥Î≤à Îã¨ ÌôúÎèô</div><div class="cal-grid" id="cal-grid"></div></div>
  <div class="rec-target">
    <div class="rt-top"><div><div class="rt-lbl">Ïù¥Î≤à Îã¨ Î™©Ìëú</div><div class="rt-val">37.8 <span style="font-size:14px;font-weight:200;color:var(--dim)">/ 100 km</span></div></div><span class="rt-pct">38%</span></div>
    <div class="rt-bar"><div class="rt-fill" id="rt-fill" style="width:0%"></div></div>
  </div>
  <div class="rec-log">
    <div class="rec-log-hd"><span class="rec-log-title">ÏµúÍ∑º Îü∞</span><span class="rec-log-cnt">6Ìöå</span></div>
    <div id="run-log"></div>
  </div>
  <div class="rec-crews">
    <div class="rec-crews-title">Ï∞∏Ïó¨Ìïú ÌÅ¨Î£®</div>
    <div id="rec-past-crews"></div>
  </div>
</div>

</div><!-- /main -->

<!-- BOTTOM TABS -->
<div id="btabs">
  <button class="btab on" data-v="home">
    <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>Ìôà<div class="btab-dot"></div>
  </button>
  <button class="btab" data-v="crew">
    <svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>ÌÅ¨Î£®<div class="btab-dot"></div>
  </button>
  <button class="btab btab-start" data-v="run">
    <div class="btab-run-wrap"><svg viewBox="0 0 24 24" style="width:18px;height:18px"><polygon points="5 3 19 12 5 21 5 3" fill="currentColor" stroke="none"/></svg></div>ÏãúÏûë
  </button>
  <button class="btab" data-v="shot">
    <svg viewBox="0 0 24 24"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>Ïù∏Ï¶ùÏÉ∑<div class="btab-dot"></div>
  </button>
  <button class="btab" data-v="records">
    <svg viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>ÎÇ¥ Í∏∞Î°ù<div class="btab-dot"></div>
  </button>
</div>

<!-- MODALS -->
<div id="m-join" class="modal"><div class="m-box">
  <div class="m-title">ÌÅ¨Î£® Ï∞∏Ïó¨ÌïòÍ∏∞</div><div class="m-sub">Ï¥àÎåÄ ÏΩîÎìúÎ•º ÏûÖÎ†•ÌïòÎ©¥ ÌÅ¨Î£®ÏõêÏùò Í∏∞Î°ùÏùÑ Ìï®Íªò Î≥º Ïàò ÏûàÏñ¥Ïöî</div>
  <input class="join-inp" id="jin" type="text" placeholder="Ï¥àÎåÄ ÏΩîÎìú (Ïòà: GR-2847)" maxlength="10" oninput="onJoinInput(this.value)">
  <div class="join-prev" id="jprev"><span style="font-size:26px" id="jp-em">üëª</span><div style="flex:1"><div style="font-size:14px;font-weight:300;margin-bottom:3px" id="jp-name"></div><div style="font-size:10px;color:var(--dim)" id="jp-meta"></div></div><span style="font-family:var(--fd);font-style:italic;font-size:22px;color:var(--acc)" id="jp-pct"></span></div>
  <button class="m-ok" id="jok" style="display:none" onclick="confirmJoin()">Ïù¥ ÌÅ¨Î£® Ï∞∏Ïó¨ÌïòÍ∏∞ ü§ù</button>
  <button class="m-cancel" onclick="closeModal('m-join')">Ï∑®ÏÜå</button>
</div></div>

<div id="m-create" class="modal"><div class="m-box">
  <div class="m-title">ÏÉà ÌÅ¨Î£® ÎßåÎì§Í∏∞</div><div class="m-sub">ÌÅ¨Î£®Î•º ÎßåÎì§Í≥† ÏπúÍµ¨Îì§ÏùÑ Ï¥àÎåÄÌï¥Î≥¥ÏÑ∏Ïöî</div>
  <div class="mf"><div class="ml">ÌÅ¨Î£® Ïù¥Î¶Ñ</div><input class="mi" id="cn-inp" type="text" placeholder="Ïòà: ÏÉàÎ≤Ω Ïú†Î†π ÌÅ¨Î£®" maxlength="16"></div>
  <div class="mf"><div class="ml">ÌÅ¨Î£® Ïù¥Î™®ÏßÄ</div>
    <div class="em-row" id="em-row">
      <div class="em-opt on" data-em="üëª">üëª</div><div class="em-opt" data-em="üßõ">üßõ</div><div class="em-opt" data-em="üßü">üßü</div><div class="em-opt" data-em="üíÄ">üíÄ</div><div class="em-opt" data-em="üéÉ">üéÉ</div><div class="em-opt" data-em="ü¶á">ü¶á</div><div class="em-opt" data-em="üòà">üòà</div><div class="em-opt" data-em="‚ö°">‚ö°</div>
    </div>
  </div>
  <div class="mf"><div class="ml">Ïù¥Î≤à Îã¨ Î™©Ìëú</div>
    <div class="g-row" id="g-row">
      <div class="g-opt" data-km="50"><span>50</span><span>km</span></div>
      <div class="g-opt on" data-km="100"><span>100</span><span>km</span></div>
      <div class="g-opt" data-km="150"><span>150</span><span>km</span></div>
      <div class="g-opt" data-km="200"><span>200</span><span>km</span></div>
    </div>
  </div>
  <div class="mf"><div class="ml">ÌôúÎèô ÏßÄÏó≠</div><input class="mi" id="ca-inp" type="text" placeholder="Ïòà: ÎßàÌè¨Íµ¨" maxlength="12" value="ÎßàÌè¨Íµ¨"></div>
  <button class="m-ok" onclick="confirmCreate()">ÌÅ¨Î£® ÎßåÎì§Í∏∞ ‚ú®</button>
  <button class="m-cancel" onclick="closeModal('m-create')">Ï∑®ÏÜå</button>
</div></div>

<div id="m-expert" class="modal"><div class="m-box">
  <div class="m-title">Expert ÌÅ¨Î£®</div><div class="m-sub">ÏùºÏ†ï Í∏∞Í∞Ñ Îã¨ÏÑ± Ïãú Ï†ÑÏö© ÌÅ¨Î£®Î•º Í∞úÏÑ§Ìï† Ïàò ÏûàÏñ¥Ïöî</div>
  <div style="display:flex;align-items:center;gap:12px;padding:14px 16px;background:var(--sf);border:1px solid var(--ln);border-radius:14px;margin-bottom:8px;cursor:pointer">
    <span style="font-size:24px">üëª</span>
    <div style="flex:1"><div style="font-size:13px;font-weight:300">Ghost Master ÌÅ¨Î£®</div><div style="font-size:10px;color:var(--dim);margin-top:2px">Ï°∞Í±¥: 3Í∞úÏõî Ïó∞ÏÜç 100km Îã¨ÏÑ± ‚úì</div></div>
    <span style="font-size:10px;color:rgba(200,240,80,.8)">Í∞úÏÑ§ Í∞ÄÎä•</span>
  </div>
  <div style="display:flex;align-items:center;gap:12px;padding:14px 16px;background:var(--sf);border:1px solid var(--ln);border-radius:14px;margin-bottom:8px;opacity:.5">
    <span style="font-size:24px">üíÄ</span>
    <div style="flex:1"><div style="font-size:13px;font-weight:300">Skull Elite ÌÅ¨Î£®</div><div style="font-size:10px;color:var(--dim);margin-top:2px">Ï°∞Í±¥: 6Í∞úÏõî Ïó∞ÏÜç 150km (4/6 ÏßÑÌñâÏ§ë)</div></div>
    <span style="font-size:11px;color:rgba(255,255,255,.25)">üîí</span>
  </div>
  <button class="m-cancel" onclick="closeModal('m-expert')">Îã´Í∏∞</button>
</div></div>

<div id="m-member" class="modal"><div class="m-box" id="mm-box"></div></div>
<div id="avs"><div class="av-box"><div class="av-ttl">Ï∫êÎ¶≠ÌÑ∞ ÏÑ†ÌÉù</div><div class="av-grid" id="avgrid"></div></div></div>
<canvas id="ec" style="display:none"></canvas>
<div id="flash"></div>
<div id="toast"></div>

<script>
'use strict';

// DATA
// ÌÅ¨Î£®Ïõê Ïù¥Î¶ÑÏùÄ ÌÅ¨Î£®Î™Ö Í∏∞Î∞òÏúºÎ°ú ÎèôÏ†Å ÏÉùÏÑ±
function makeCrewMembers(crewName, emoji, myIdx=2){
  const base=crewName.replace(' ÌÅ¨Î£®','');
  return Array.from({length:8},(_, i)=>({e:emoji,n:base+(i+1),d:[8.40,7.85,5.20,4.90,4.10,3.80,2.40,1.20][i],me:i===myIdx}));
}
let CREW=makeCrewMembers('Ïú†Î†π','üëª',2);
const GOAL=100,MI=CREW.findIndex(c=>c.me),MR=MI+1,N=CREW.length;
const TKM=parseFloat(CREW.reduce((s,c)=>s+c.d,0).toFixed(2));
const PCT=Math.round(TKM/GOAL*100);
const NEARBY=[
  {n:'ÎìúÎùºÌÅòÎùº ÌÅ¨Î£®',e:'üßõ',code:'#GR-1138',cnt:8,total:62.4,goal:100,rank:1,mine:false},
  {n:'Ï¢ÄÎπÑ ÌÅ¨Î£®',e:'üßü',code:'#GR-0442',cnt:6,total:51.8,goal:80,rank:2,mine:false},
  {n:'Ïú†Î†π ÌÅ¨Î£®',e:'üëª',code:'#GR-2847',cnt:8,total:37.85,goal:100,rank:3,mine:true},
  {n:'Ìò∏Î∞ï ÌÅ¨Î£®',e:'üéÉ',code:'#GR-3391',cnt:5,total:28.6,goal:60,rank:4,mine:false},
  {n:'Ìï¥Í≥® ÌÅ¨Î£®',e:'üíÄ',code:'#GR-5512',cnt:7,total:22.1,goal:70,rank:5,mine:false},
  {n:'Î∞ïÏ•ê ÌÅ¨Î£®',e:'ü¶á',code:'#GR-6680',cnt:4,total:15.3,goal:50,rank:6,mine:false},
];
const PAST=[
  {n:'Ïú†Î†π ÌÅ¨Î£®',e:'üëª',period:'2025.02',rank:3,d:5.20,xp:true,active:true},
  {n:'Ï¢ÄÎπÑ ÌÅ¨Î£®',e:'üßü',period:'2025.01',rank:1,d:9.80,xp:false,active:false},
  {n:'Ìï¥Í≥® ÌÅ¨Î£®',e:'üíÄ',period:'2024.12',rank:2,d:7.60,xp:true,active:false},
  {n:'ÎìúÎùºÌÅòÎùº ÌÅ¨Î£®',e:'üßõ',period:'2024.11',rank:4,d:6.10,xp:false,active:false},
  {n:'Î∞ïÏ•ê ÌÅ¨Î£®',e:'ü¶á',period:'2024.10',rank:1,d:11.20,xp:false,active:false},
];
const LOGS=[
  {date:'02.18',mo:'Feb',d:5.20,pace:"5'12\"",time:"26'58\"",cal:312,crew:'Ïú†Î†π ÌÅ¨Î£®',rank:3,ri:0},
  {date:'02.14',mo:'Feb',d:4.80,pace:"5'20\"",time:"25'36\"",cal:288,crew:'Ïú†Î†π ÌÅ¨Î£®',rank:4,ri:1},
  {date:'02.10',mo:'Feb',d:6.10,pace:"5'08\"",time:"31'17\"",cal:366,crew:'Ïú†Î†π ÌÅ¨Î£®',rank:2,ri:2},
  {date:'02.05',mo:'Feb',d:3.90,pace:"5'35\"",time:"21'47\"",cal:234,crew:'Ïú†Î†π ÌÅ¨Î£®',rank:5,ri:0},
  {date:'01.28',mo:'Jan',d:9.80,pace:"5'01\"",time:"49'10\"",cal:588,crew:'Ï¢ÄÎπÑ ÌÅ¨Î£®',rank:1,ri:1},
  {date:'01.21',mo:'Jan',d:8.40,pace:"5'14\"",time:"43'58\"",cal:504,crew:'Ï¢ÄÎπÑ ÌÅ¨Î£®',rank:2,ri:2},
];
function getMemberRuns(crewName){
  const base=crewName.replace(' ÌÅ¨Î£®','');
  return {
    [base+'1']:[{d:'02.17',km:2.50,p:"5'20\""},{d:'02.13',km:3.10,p:"5'15\""}],
    [base+'2']:[{d:'02.16',km:3.20,p:"5'10\""},{d:'02.12',km:2.60,p:"5'18\""}],
    [base+'4']:[{d:'02.15',km:2.10,p:"5'30\""}],
    [base+'5']:[{d:'02.14',km:1.50,p:"5'45\""}],
    [base+'6']:[{d:'02.13',km:1.20,p:"5'50\""},{d:'02.09',km:1.30,p:"5'48\""}],
    [base+'7']:[{d:'02.12',km:0.90,p:"6'00\""}],
    [base+'8']:[{d:'02.18',km:0.60,p:"6'10\""}],
  };
}
const CODEMAP={
  'GR-2847':{n:'Ïú†Î†π ÌÅ¨Î£®',e:'üëª',meta:'ÎßàÌè¨Íµ¨ ¬∑ 8Î™Ö ¬∑ #GR-2847',pct:38},
  'GR-1138':{n:'ÎìúÎùºÌÅòÎùº ÌÅ¨Î£®',e:'üßõ',meta:'ÎßàÌè¨Íµ¨ ¬∑ 8Î™Ö ¬∑ #GR-1138',pct:62},
  'GR-0442':{n:'Ï¢ÄÎπÑ ÌÅ¨Î£®',e:'üßü',meta:'ÎßàÌè¨Íµ¨ ¬∑ 6Î™Ö ¬∑ #GR-0442',pct:65},
  'GR-3391':{n:'Ìò∏Î∞ï ÌÅ¨Î£®',e:'üéÉ',meta:'ÎßàÌè¨Íµ¨ ¬∑ 5Î™Ö ¬∑ #GR-3391',pct:48},
};
const RC=r=>r===1?'g':r===2?'s':r===3?'b':'o';
const COL=r=>r===1?'#d4b54a':r===2?'#a0aab4':r===3?'#b07444':'#c8f050';

// STATE
let hasCrew=false,curTab='home';
let selEm='üëª',selGoal=100;
let joinTarget=null;
let crewInited=false,nearInited=false,pastInited=false,recInited=false;

// ROUTE DATA
const ROUTE=[[37.5665,126.978],[37.567,126.979],[37.5676,126.9796],[37.5682,126.9803],[37.5687,126.9814],[37.5681,126.9822],[37.5673,126.9828],[37.5664,126.9822],[37.5656,126.9815],[37.565,126.9804],[37.5648,126.9793],[37.5654,126.9782],[37.566,126.9778],[37.5665,126.978]];
const ROUTES=[ROUTE,ROUTE.map(p=>[p[0]+.003,p[1]-.002]),ROUTE.map(p=>[p[0]-.002,p[1]+.003])];

// SPLASH
function hideSplash(){
  document.getElementById('splash').classList.add('out');
  setTimeout(()=>{
    const sp=document.getElementById('splash');if(sp)sp.remove();
    // Show login if not logged in
    if(!GR_API.currentUser()){showLoginScreen();}
  },800);
}

// CLOCK
function tick(){
  const n=new Date(),p=v=>String(v).padStart(2,'0');
  document.getElementById('clock').textContent=`${p(n.getHours())}:${p(n.getMinutes())}`;
  const ds=`${n.getFullYear()}.${p(n.getMonth()+1)}.${p(n.getDate())}`;
  const dtg=document.getElementById('dt-g');if(dtg)dtg.innerHTML=`${ds}<br>${n.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'})}`;
  const bd=document.getElementById('bd');if(bd)bd.textContent=ds;
  const tag=document.getElementById('hm-tag');if(tag)tag.textContent=`${n.getFullYear()}ÎÖÑ ${n.getMonth()+1}Ïõî`;
}
tick();setInterval(tick,1000);

// TABS
function goTab(v){
  if(v===curTab&&v!=='run')return;
  curTab=v;
  document.querySelectorAll('.mview').forEach(el=>el.classList.remove('on'));
  document.getElementById('v-'+v).classList.add('on');
  document.querySelectorAll('.btab').forEach(t=>t.classList.toggle('on',t.dataset.v===v));
  if(v==='crew'){showCrewView();if(hasCrew){initCrew();initNear();initPast();}}
  if(v==='records')initRec();
  if(v==='shot')applyRank();
}
document.getElementById('btabs').addEventListener('click',e=>{const b=e.target.closest('.btab');if(b)goTab(b.dataset.v);});

// HOME crew list
function buildHomeCrewList(){
  const el=document.getElementById('hm-crew');el.innerHTML='';
  const maxD=CREW[0].d;
  CREW.slice(0,5).forEach((c,i)=>{
    const rank=i+1,k=RC(rank),me=c.me;
    const row=document.createElement('div');row.className='hm-cbar';
    row.innerHTML=`<span class="hm-cb-rk ${k}">${rank}</span><span class="hm-cb-em">${c.e}</span><div class="hm-cb-info"><div class="hm-cb-name">${c.n}${me?'<span style="font-size:9px;color:rgba(200,240,80,.6);margin-left:5px">ÎÇò</span>':''}</div><div class="hm-cb-dist">${c.d.toFixed(2)} km</div></div><div class="hm-cb-bar"><div class="hm-cb-bg"><div class="hm-cb-fill" style="width:${Math.round(c.d/maxD*100)}%;background:${me?'var(--acc)':rank<=3?COL(rank):'rgba(255,255,255,.2)'}"></div></div></div>`;
    el.appendChild(row);
  });
}
buildHomeCrewList();

// RUN
let goalType='dist',goalVal='5';
let runTimer=null,runSec=0,runDist=0,runPaused=false,watchId=null;
let locGranted=false,userLat=37.5665,userLng=126.978;
let gmap=null,gmarker=null,gmapActive=null,gmarkerActive=null,gpathActive=null,pathCoords=[];

// goal type switching
document.querySelectorAll('.gt').forEach(el=>{
  el.addEventListener('click',()=>{
    document.querySelectorAll('.gt').forEach(x=>x.classList.remove('on'));
    el.classList.add('on');goalType=el.dataset.gt;
    const lbls={dist:'Î™©Ìëú Í±∞Î¶¨',time:'Î™©Ìëú ÏãúÍ∞Ñ',speed:'Î™©Ìëú ÌéòÏù¥Ïä§',free:'ÏûêÏú† Îã¨Î¶¨Í∏∞'};
    document.getElementById('gvlbl').textContent=lbls[goalType];
    ['gvd','gvt','gvs'].forEach(id=>document.getElementById(id).style.display='none');
    if(goalType==='dist')document.getElementById('gvd').style.display='grid';
    else if(goalType==='time')document.getElementById('gvt').style.display='grid';
    else if(goalType==='speed')document.getElementById('gvs').style.display='grid';
    const onEl=document.querySelector('#gv'+goalType[0]+' .gv.on');
    goalVal=onEl?onEl.dataset.v:'0';
  });
});
['gvd','gvt','gvs'].forEach(gid=>{
  document.getElementById(gid).querySelectorAll('.gv').forEach(el=>{
    el.addEventListener('click',()=>{
      document.querySelectorAll('#'+gid+' .gv').forEach(x=>x.classList.remove('on'));
      el.classList.add('on');goalVal=el.dataset.v;
    });
  });
});

// location
function reqLoc(){
  if(!navigator.geolocation){showToast('ÏúÑÏπò Í∏∞Îä•ÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏïÑÏöî');return;}
  navigator.geolocation.getCurrentPosition(pos=>{
    locGranted=true;userLat=pos.coords.latitude;userLng=pos.coords.longitude;
    document.getElementById('loc-btn').classList.add('on');
    document.getElementById('loc-txt').textContent='ÏúÑÏπò Í≥µÏú† Ï§ë';
    document.getElementById('map-ph').classList.add('hide');
    tryInitSetupMap();
    showToast('üìç ÎÇ¥ ÏúÑÏπòÍ∞Ä Í≥µÏú†Îê©ÎãàÎã§');
  },()=>showToast('ÏúÑÏπò Í∂åÌïúÏùÑ ÌóàÏö©Ìï¥Ï£ºÏÑ∏Ïöî'),{enableHighAccuracy:true});
}

function tryInitSetupMap(){
  if(typeof google==='undefined'||gmap)return;
  gmap=new google.maps.Map(document.getElementById('gmap'),{
    center:{lat:userLat,lng:userLng},zoom:16,
    styles:darkMapStyle(),disableDefaultUI:true,gestureHandling:'greedy',backgroundColor:'#0a0a0d'
  });
  gmarker=new google.maps.Marker({position:{lat:userLat,lng:userLng},map:gmap,icon:{path:google.maps.SymbolPath.CIRCLE,scale:8,fillColor:'#c8f050',fillOpacity:1,strokeColor:'#0a0a0d',strokeWeight:2}});
}

function darkMapStyle(){return[{featureType:'all',elementType:'labels',stylers:[{visibility:'off'}]},{featureType:'road',elementType:'geometry',stylers:[{color:'#1a1a28'}]},{featureType:'water',elementType:'geometry',stylers:[{color:'#080810'}]},{featureType:'landscape',elementType:'geometry',stylers:[{color:'#0c0c14'}]},{featureType:'poi',elementType:'geometry',stylers:[{color:'#111118'}]}];}

function startRun(){
  document.getElementById('rsetup').classList.remove('on');
  document.getElementById('ractive').classList.add('on');
  const lbl={dist:'Î™©Ìëú '+goalVal+'km',time:'Î™©Ìëú '+goalVal+'Î∂Ñ',speed:'Î™©Ìëú ÌéòÏù¥Ïä§ '+goalVal+' sec/km',free:'ÏûêÏú† Îã¨Î¶¨Í∏∞'};
  document.getElementById('ra-gl-txt').textContent=lbl[goalType]||'Îã¨Î¶¨Îäî Ï§ë';
  runSec=0;runDist=0;runPaused=false;pathCoords=[];
  // init active map
  if(typeof google!=='undefined'){
    document.getElementById('ra-ph').classList.add('hide');
    gmapActive=new google.maps.Map(document.getElementById('gmap-active'),{
      center:{lat:userLat,lng:userLng},zoom:17,
      styles:darkMapStyle(),disableDefaultUI:true,gestureHandling:'none',backgroundColor:'#0a0a0d'
    });
    gmarkerActive=new google.maps.Marker({position:{lat:userLat,lng:userLng},map:gmapActive,icon:{path:google.maps.SymbolPath.CIRCLE,scale:9,fillColor:'#c8f050',fillOpacity:1,strokeColor:'#0a0a0d',strokeWeight:2}});
    gpathActive=new google.maps.Polyline({path:[],geodesic:true,strokeColor:'#c8f050',strokeOpacity:.85,strokeWeight:3,map:gmapActive});
  }
  if(locGranted){
    watchId=navigator.geolocation.watchPosition(pos=>{
      const lat=pos.coords.latitude,lng=pos.coords.longitude;
      if(gmarkerActive)gmarkerActive.setPosition({lat,lng});
      if(gmapActive)gmapActive.panTo({lat,lng});
      if(pathCoords.length>0){const prev=pathCoords[pathCoords.length-1];runDist+=haversine(prev[0],prev[1],lat,lng);}
      pathCoords.push([lat,lng]);
      if(gpathActive)gpathActive.setPath(pathCoords.map(p=>({lat:p[0],lng:p[1]})));
    },{enableHighAccuracy:true,maximumAge:1000});
  }
  runTimer=setInterval(runTick,1000);
}

function runTick(){
  if(runPaused)return;
  runSec++;
  if(!locGranted)runDist+=0.0014+Math.random()*.0008; // simulate
  const mins=Math.floor(runSec/60),secs=runSec%60;
  document.getElementById('ra-time').textContent=`${String(mins).padStart(2,'0')}:${String(secs).padStart(2,'0')}`;
  document.getElementById('ra-dist').textContent=runDist.toFixed(2);
  document.getElementById('ra-cal').textContent=Math.round(runDist*65);
  const paceS=runDist>0?Math.round(runSec/runDist):0;
  const pm=Math.floor(paceS/60),ps=paceS%60;
  document.getElementById('ra-pace').textContent=runDist>0?`${pm}'${String(ps).padStart(2,'0')}"`:"-'-\"";
  let pct=0;
  if(goalType==='dist')pct=Math.min(runDist/parseFloat(goalVal)*100,100);
  else if(goalType==='time')pct=Math.min(runSec/(parseInt(goalVal)*60)*100,100);
  document.getElementById('ra-fill').style.width=pct+'%';
  document.getElementById('ra-pct-txt').textContent=Math.round(pct)+'%';
}

function haversine(la1,lo1,la2,lo2){
  const R=6371,dLa=(la2-la1)*Math.PI/180,dLo=(lo2-lo1)*Math.PI/180;
  const a=Math.sin(dLa/2)**2+Math.cos(la1*Math.PI/180)*Math.cos(la2*Math.PI/180)*Math.sin(dLo/2)**2;
  return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}

function togglePause(){
  runPaused=!runPaused;
  document.getElementById('pause-ico').innerHTML=runPaused
    ?'<polygon points="5 3 19 12 5 21 5 3" fill="var(--acc)" stroke="none"/>'
    :'<rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>';
  document.getElementById('pause-ico').setAttribute('stroke',runPaused?'none':'var(--mid)');
}

function stopRun(){
  clearInterval(runTimer);
  if(watchId)navigator.geolocation.clearWatch(watchId);
  document.getElementById('ractive').classList.remove('on');
  document.getElementById('rfinish').classList.add('on');
  const mins=Math.floor(runSec/60),secs=runSec%60;
  document.getElementById('rf-d').textContent=runDist.toFixed(2);
  document.getElementById('rf-t').textContent=`${String(mins).padStart(2,'0')}:${String(secs).padStart(2,'0')}`;
  const paceS=runDist>0?Math.round(runSec/runDist):0;
  const pm=Math.floor(paceS/60),ps=paceS%60;
  document.getElementById('rf-p').textContent=runDist>0?`${pm}'${String(ps).padStart(2,'0')}"`:"-'-\"";
  document.getElementById('rf-c').textContent=Math.round(runDist*65);
  document.getElementById('rf-msg').textContent=runDist>=5?'Ïò§ÎäòÎèÑ Î©ãÏßÄÍ≤å Îã¨Î†∏Ïñ¥Ïöî üéâ':runDist>=2?'Ï¢ãÏùÄ ÌéòÏù¥Ïä§ÏòàÏöî!':'ÎÇ¥ÏùºÏùÄ Îçî Î©ÄÎ¶¨ Îã¨Î†§Î¥êÏöî';
}

function resetRun(){
  document.getElementById('rfinish').classList.remove('on');
  document.getElementById('ractive').classList.remove('on');
  document.getElementById('rsetup').classList.add('on');
  runSec=0;runDist=0;
}

// CREW
function showCrewView(){
  document.getElementById('no-crew').style.display=hasCrew?'none':'flex';
  const cc=document.getElementById('crew-content');
  cc.style.display=hasCrew?'flex':'none';
}
function quickJoin(name,em){
  hasCrew=true;
  CREW=makeCrewMembers(name,em,2);
  document.getElementById('ch-name').textContent=em+' '+name;
  showCrewView();crewInited=false;nearInited=false;pastInited=false;
  initCrew();initNear();initPast();
  showToast('ü§ù '+name+'Ïóê Ï∞∏Ïó¨ÌñàÏñ¥Ïöî!');
}
document.getElementById('ctabs').addEventListener('click',e=>{
  const b=e.target.closest('.ctab');if(!b)return;
  const c=b.dataset.c;
  document.querySelectorAll('.cpane').forEach(el=>el.classList.remove('on'));
  document.getElementById('cp-'+c).classList.add('on');
  document.querySelectorAll('.ctab').forEach(t=>t.classList.toggle('on',t.dataset.c===c));
  if(c==='my')initCrew();if(c==='near')initNear();if(c==='past')initPast();
});
function initCrew(){
  if(crewInited)return;crewInited=true;
  const myD=CREW[MI].d,maxD=CREW[0].d;
  document.getElementById('gcc').textContent=TKM.toFixed(1);document.getElementById('gcp').textContent=PCT+'%';
  document.getElementById('gcm1').textContent=N+'Î™Ö';document.getElementById('gcm2').textContent=(myD/GOAL*100).toFixed(1)+'%';
  document.getElementById('gcm3').textContent=MR===1?'ü•á 1ÏúÑ':'‚àí'+(maxD-myD).toFixed(1)+'km';
  document.getElementById('gcm4').textContent=(GOAL-TKM).toFixed(1)+'km';
  document.getElementById('lbcnt').textContent=N+'Î™Ö';
  setTimeout(()=>document.getElementById('gcpf').style.width=Math.min(PCT,100)+'%',80);
  const lb=document.getElementById('crew-lb');lb.innerHTML='';
  CREW.forEach((c,i)=>{
    const rank=i+1,me=c.me,k=RC(rank),posC=rank<=3?k:'';
    const row=document.createElement('div');row.className='lbrow'+(me?'  me':' click');
    if(!me)row.onclick=()=>openMemberModal(c,rank);
    row.innerHTML=`<span class="lbpos${posC?' '+posC:''}">${rank}</span><span class="lbem">${c.e}</span><div class="lb-nc"><div class="lb-nm">${c.n}${me?'<span style="font-size:9px;color:rgba(200,240,80,.6);margin-left:5px">ÎÇò</span>':''}</div>${!me?'<div class="lb-hint">Í∏∞Î°ù Î≥¥Í∏∞ ‚Üí</div>':''}</div><div class="lb-rt"><span class="lb-d">${c.d.toFixed(2)}<span style="font-size:9px;opacity:.4"> km</span></span><div class="lb-bg"><div class="lb-bar ${me?'me':posC||'o'}" style="width:${Math.round(c.d/maxD*100)}%"></div></div></div>`;
    lb.appendChild(row);
  });
}
function initNear(){
  if(nearInited)return;nearInited=true;
  const el=document.getElementById('nearby-list');el.innerHTML='';
  NEARBY.forEach(r=>{
    const pct=Math.round(r.total/r.goal*100),k=RC(r.rank);
    const row=document.createElement('div');row.className='nb-row';
    if(r.mine)row.style.cssText='border-left:2px solid rgba(200,240,80,.35);padding-left:10px;margin-left:-10px';
    row.innerHTML=`<div class="nb-top"><div><div style="display:flex;align-items:center;gap:7px"><span class="nb-rn ${k}">${r.rank}</span><span class="nb-cname">${r.e} ${r.n}</span>${r.mine?'<span class="nb-mine">ÎÇ¥ ÌÅ¨Î£®</span>':''}</div><div class="nb-cmeta">${r.code} ¬∑ ${r.cnt}Î™Ö</div></div><span class="nb-pct">${pct}%</span></div><div class="nb-prog"><div class="nb-pf" style="width:${pct}%"><div class="nb-pd"></div></div></div><div class="nb-bot"><div class="nb-ghosts">${Array(r.cnt).fill(r.e).join('')}</div><div class="nb-nums"><div class="nbn"><span class="nbn-l">Îã¨ÏÑ±</span><span class="nbn-v">${r.total.toFixed(1)}<span style="font-family:var(--fb);font-size:10px;color:var(--dim)"> km</span></span></div><div class="nbn"><span class="nbn-l">Î™©Ìëú</span><span class="nbn-v" style="color:var(--mid)">${r.goal}<span style="font-family:var(--fb);font-size:10px;color:var(--dim)"> km</span></span></div></div></div>`;
    el.appendChild(row);
  });
}
function initPast(){
  if(pastInited)return;pastInited=true;
  const el=document.getElementById('past-list');el.innerHTML='';
  PAST.forEach(c=>{
    const k=RC(c.rank);const card=document.createElement('div');card.className='past-card';
    card.innerHTML=`<span class="pc-em">${c.e}</span><div class="pc-info"><div class="pc-name">${c.n}${c.active?'<span style="font-size:9px;color:rgba(200,240,80,.7);margin-left:5px">ÌôúÎèôÏ§ë</span>':''}</div><div class="pc-meta">${c.period} ¬∑ ${c.d.toFixed(1)}km</div>${c.xp?'<span class="pc-xb">‚≠ê Expert</span>':''}</div><div class="pc-right"><span class="pc-rank ${k}">${c.rank}Îì±</span><span class="pc-dist">${c.d.toFixed(1)}km</span></div>`;
    el.appendChild(card);
  });
}

// MEMBER MODAL
function openMemberModal(c,rank){
  const k=RC(rank);const crewNameForRuns=document.getElementById('ch-name').textContent.replace(/^./,'').trim();const runs=getMemberRuns(crewNameForRuns)[c.n]||[];
  const box=document.getElementById('mm-box');
  box.innerHTML=`<div class="mm-hd"><span class="mm-em">${c.e}</span><div><div class="mm-name">${c.n}</div><div class="mm-cl">Ïú†Î†π ÌÅ¨Î£®</div></div><span class="mm-rank ${k}">${rank}Îì±</span></div><div class="mm-stats"><div class="mm-st"><span class="mm-sl">Ïù¥Î≤à Îã¨</span><span class="mm-sv">${c.d.toFixed(1)}<span style="font-family:var(--fb);font-size:13px;color:var(--dim)"> km</span></span></div><div class="mm-st"><span class="mm-sl">ÏµúÍ∑º Îü∞</span><span class="mm-sv">${runs.length}<span style="font-family:var(--fb);font-size:13px;color:var(--dim)"> Ìöå</span></span></div><div class="mm-st"><span class="mm-sl">ÌòÑÏû¨ ÏàúÏúÑ</span><span class="mm-rank ${k}" style="font-size:22px">${rank}</span></div></div><div class="mm-rl">ÏµúÍ∑º Îü¨Îãù</div>${runs.map(r=>`<div class="mm-rr"><span class="mm-rd">${r.d}</span><span class="mm-rk">${r.km.toFixed(2)} km</span><span class="mm-rp">${r.p}</span></div>`).join('')}<button class="mm-close" onclick="closeModal('m-member')">Îã´Í∏∞</button>`;
  openModal('m-member');
}

// SHOT
function applyRank(){
  const k=RC(MR);
  ['cn-g','cn-p'].forEach(id=>{const el=document.getElementById(id);if(el){el.className='ch-n '+k;el.textContent=MR;}});
  document.getElementById('co-g').textContent='/ '+N;
  document.getElementById('co-p').textContent=N+'Î™Ö Ï§ë';
  const sr=document.getElementById('st-rn');if(sr){sr.className='st-rn '+k;sr.textContent=MR+'Îì±';}
  document.getElementById('st-of').textContent='/ '+N+'Î™Ö';
  buildBoard();
}
function buildBoard(){
  const b=document.getElementById('gboard');if(!b)return;
  b.innerHTML='<div class="gb-lbl">ÌÅ¨Î£® ÏàúÏúÑ</div>';
  const show=MR>3?[...CREW.slice(0,3),null,CREW[MI]]:CREW.slice(0,3);
  show.forEach(c=>{
    if(!c){const s=document.createElement('div');s.style.cssText='height:1px;background:rgba(255,255,255,.06);margin:2px 0';b.appendChild(s);return;}
    const r=CREW.indexOf(c)+1,me=c.me,k=RC(r);
    const row=document.createElement('div');row.className='gb-row'+(me?' me':'');
    row.innerHTML=`<span class="gb-n ${k}">${r}</span><span class="gb-e">${c.e}</span><span class="gb-d${me?' me':''}">${c.d.toFixed(1)}</span>`;
    b.appendChild(row);
  });
}
drawRoute(document.getElementById('mmg'),{ri:0});
drawRoute(document.getElementById('mmp'),{lw:3,pad:18,alpha:.2,ri:0});
drawRoute(document.getElementById('mms'),{ri:0});

function drawRoute(canvas,opts={}){
  const{stroke='#c8f050',lw=1.5,pad=7,alpha=.82,ri=0}=opts;
  const R=ROUTES[ri%3];const W=canvas.width,H=canvas.height,ctx=canvas.getContext('2d');
  ctx.clearRect(0,0,W,H);
  const la=R.map(p=>p[0]),ln=R.map(p=>p[1]);
  const mla=Math.min(...la),xla=Math.max(...la),mln=Math.min(...ln),xln=Math.max(...ln);
  const rl=xla-mla||.001,rn=xln-mln||.001;
  const xy=(a,n2)=>[pad+(n2-mln)/rn*(W-pad*2),pad+(xla-a)/rl*(H-pad*2)];
  ctx.save();ctx.strokeStyle=stroke;ctx.lineWidth=lw+2;ctx.lineJoin='round';ctx.lineCap='round';ctx.globalAlpha=.08;
  ctx.beginPath();R.forEach(([a,n2],i)=>{const[x,y]=xy(a,n2);i?ctx.lineTo(x,y):ctx.moveTo(x,y);});ctx.stroke();ctx.restore();
  ctx.save();ctx.strokeStyle=stroke;ctx.lineWidth=lw;ctx.lineJoin='round';ctx.lineCap='round';ctx.globalAlpha=alpha;
  ctx.beginPath();R.forEach(([a,n2],i)=>{const[x,y]=xy(a,n2);i?ctx.lineTo(x,y):ctx.moveTo(x,y);});ctx.stroke();ctx.restore();
  const last=R[R.length-1];const[ex,ey]=xy(last[0],last[1]);
  ctx.save();ctx.beginPath();ctx.arc(ex,ey,2.5,0,Math.PI*2);ctx.fillStyle=stroke;ctx.shadowColor=stroke;ctx.shadowBlur=6;ctx.fill();ctx.restore();
}

let AT='g';
document.getElementById('tbar').addEventListener('click',e=>{
  const b=e.target.closest('.th');if(!b)return;const t=b.dataset.t;if(t===AT)return;AT=t;
  ['ov-g','ov-p','ov-s'].forEach(id=>document.getElementById(id).classList.toggle('off',!id.endsWith(t)));
  document.querySelectorAll('.th').forEach(x=>x.classList.toggle('on',x.dataset.t===t));
});
let pURL=null;
const bgEl=document.getElementById('bg-img'),emEl=document.getElementById('empty-state');
function loadFile(f){if(!f?.type.startsWith('image/'))return;if(pURL)URL.revokeObjectURL(pURL);pURL=URL.createObjectURL(f);bgEl.onload=()=>{bgEl.style.opacity='1';emEl.style.display='none';};bgEl.src=pURL;}
document.getElementById('ic').addEventListener('change',e=>loadFile(e.target.files[0]));
document.getElementById('ig').addEventListener('change',e=>loadFile(e.target.files[0]));

const AVATARS=[{e:'üëª',l:'Ïú†Î†π'},{e:'üßõ',l:'Î±ÄÌååÏù¥Ïñ¥'},{e:'üßü',l:'Ï¢ÄÎπÑ'},{e:'üßå',l:'Í¥¥Î¨º'},{e:'üíÄ',l:'Ìï¥Í≥®'},{e:'üï∑',l:'Í±∞ÎØ∏'},{e:'ü¶á',l:'Î∞ïÏ•ê'},{e:'üê∫',l:'ÎäëÎåÄ'},{e:'üòà',l:'ÏïÖÎßà'},{e:'üéÉ',l:'Ìò∏Î∞ï'}];
(function(){const g=document.getElementById('avgrid');AVATARS.forEach((av,i)=>{const c=document.createElement('div');c.className='avc'+(i===0?' on':'');c.innerHTML=`<span class="ave">${av.e}</span><span class="avl">${av.l}</span>`;c.addEventListener('click',()=>{document.querySelectorAll('.avc').forEach(x=>x.classList.remove('on'));c.classList.add('on');['g','p','s'].forEach(t=>{const em=document.getElementById('em-'+t),nm=document.getElementById('nm-'+t);if(em)em.textContent=av.e;if(nm)nm.textContent='Ïú†Î†π3';});document.getElementById('em-b').textContent=av.e;closeAv();});g.appendChild(c);});})();
function openAv(){document.getElementById('avs').classList.add('on');}
function closeAv(){document.getElementById('avs').classList.remove('on');}
document.getElementById('avs').addEventListener('click',function(e){if(e.target===this)closeAv();});

// RECORDS
function initRec(){
  if(recInited)return;recInited=true;
  // calendar
  const today=new Date(),days=new Date(today.getFullYear(),today.getMonth()+1,0).getDate();
  const runDays=new Set([5,10,14,18]);
  const cg=document.getElementById('cal-grid');
  for(let d=1;d<=days;d++){const dot=document.createElement('div');dot.className='cal-d'+(d===today.getDate()?' today':runDays.has(d)?' run':'');cg.appendChild(dot);}
  setTimeout(()=>document.getElementById('rt-fill').style.width='38%',100);
  // log
  const logEl=document.getElementById('run-log');
  LOGS.forEach(r=>{
    const k=RC(r.rank);
    const item=document.createElement('div');item.className='log-item';
    const cv=document.createElement('canvas');cv.width=52;cv.height=52;cv.className='log-cv';
    drawRoute(cv,{stroke:'#c8f050',lw:1.5,pad:6,alpha:.8,ri:r.ri});
    item.innerHTML=`<div class="log-date"><span class="log-mo">${r.mo}</span><span class="log-dy">${r.date.split('.')[1]}</span></div>`;
    item.appendChild(cv);
    const info=document.createElement('div');info.className='log-info';
    info.innerHTML=`<span class="log-crew">üëª ${r.crew}</span><span class="log-km">${r.d.toFixed(2)}<span style="font-size:16px;color:var(--dim)"> km</span></span><span class="log-sub">${r.pace}/km ¬∑ ${r.time}</span>`;
    item.appendChild(info);
    const right=document.createElement('div');right.className='log-right';
    right.innerHTML=`<span class="log-rn ${k}">${r.rank}Îì±</span><span class="log-kcal">${r.cal} kcal</span>`;
    item.appendChild(right);
    logEl.appendChild(item);
  });
  // past crews
  const pcEl=document.getElementById('rec-past-crews');
  PAST.forEach(c=>{
    const k=RC(c.rank);const row=document.createElement('div');row.className='rcr';
    row.innerHTML=`<span class="rcr-em">${c.e}</span><div class="rcr-info"><div class="rcr-name">${c.n}${c.active?'<span style="font-size:9px;color:rgba(200,240,80,.7);margin-left:5px">ÌôúÎèôÏ§ë</span>':''}</div><div class="rcr-meta">${c.period} ¬∑ ${c.d.toFixed(1)}km</div></div><div class="rcr-right">${c.xp?'<span class="rcr-xp">‚≠ê Expert</span>':''}<span class="rcr-rank ${k}">${c.rank}Îì±</span></div>`;
    pcEl.appendChild(row);
  });
}

// JOIN MODAL
function onJoinInput(v){
  const code=v.toUpperCase().replace(/[^A-Z0-9\-]/g,'');
  document.getElementById('jin').value=code;
  const key=code.replace('GR-','GR-');
  const found=CODEMAP[code.replace(/^GR-?/,'GR-')] || CODEMAP[code];
  if(found){
    joinTarget=found;
    document.getElementById('jp-em').textContent=found.e;
    document.getElementById('jp-name').textContent=found.n;
    document.getElementById('jp-meta').textContent=found.meta;
    document.getElementById('jp-pct').textContent=found.pct+'%';
    document.getElementById('jprev').classList.add('on');
    document.getElementById('jok').style.display='block';
  } else {
    joinTarget=null;
    document.getElementById('jprev').classList.remove('on');
    document.getElementById('jok').style.display='none';
  }
}
function confirmJoin(){
  if(!joinTarget)return;
  hasCrew=true;
  CREW=makeCrewMembers(joinTarget.n,joinTarget.e,2);
  document.getElementById('ch-name').textContent=joinTarget.e+' '+joinTarget.n;
  document.getElementById('ch-sub').textContent=Object.keys(CODEMAP).find(k=>CODEMAP[k]===joinTarget)+' ¬∑ 2Ïõî ¬∑ 8Î™Ö';
  showCrewView();crewInited=false;nearInited=false;pastInited=false;
  initCrew();initNear();initPast();
  closeModal('m-join');
  showToast('ü§ù '+joinTarget.n+'Ïóê Ï∞∏Ïó¨ÌñàÏñ¥Ïöî!');
  joinTarget=null;
}

// CREATE MODAL
document.getElementById('em-row').addEventListener('click',e=>{
  const o=e.target.closest('.em-opt');if(!o)return;
  document.querySelectorAll('.em-opt').forEach(x=>x.classList.remove('on'));
  o.classList.add('on');selEm=o.dataset.em;
});
document.getElementById('g-row').addEventListener('click',e=>{
  const o=e.target.closest('.g-opt');if(!o)return;
  document.querySelectorAll('.g-opt').forEach(x=>x.classList.remove('on'));
  o.classList.add('on');selGoal=parseInt(o.dataset.km);
});
function confirmCreate(){
  const name=document.getElementById('cn-inp').value.trim()||'ÏÉà ÌÅ¨Î£®';
  hasCrew=true;
  CREW=makeCrewMembers(name,selEm,0);
  document.getElementById('ch-name').textContent=selEm+' '+name;
  document.getElementById('ch-sub').textContent='#GR-NEW ¬∑ 2Ïõî ¬∑ 1Î™Ö';
  showCrewView();crewInited=false;nearInited=false;pastInited=false;
  initCrew();initNear();initPast();
  closeModal('m-create');showToast('‚ú® '+name+' ÌÅ¨Î£®Í∞Ä ÎßåÎì§Ïñ¥Ï°åÏñ¥Ïöî!');
}

// MODAL helpers
function openModal(id){document.getElementById(id).classList.add('on');}
function closeModal(id){document.getElementById(id).classList.remove('on');}
document.querySelectorAll('.modal').forEach(m=>{m.addEventListener('click',function(e){if(e.target===this)closeModal(this.id);});});

// SAVE
document.getElementById('bsave').addEventListener('click',()=>{
  const card=document.getElementById('card');
  const fl=document.getElementById('flash');fl.classList.add('on');setTimeout(()=>fl.classList.remove('on'),180);
  showToast('üíæ Ïù∏Ï¶ùÏÉ∑Ïù¥ Ï†ÄÏû•ÎêêÏñ¥Ïöî');
});

// TOAST
let toastTimer=null;
function showToast(msg){
  const t=document.getElementById('toast');t.textContent=msg;t.classList.add('on');
  clearTimeout(toastTimer);toastTimer=setTimeout(()=>t.classList.remove('on'),2400);
}

// init shot rank
applyRank();


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GHOSTRUN MEMBER SERVER (localStorage mock + API-ready)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const GR_API = {
  _DB_KEY: 'ghostrun_users',
  _SESSION_KEY: 'ghostrun_session',
  _SRV_URL: null, // Set to real API endpoint e.g. 'https://api.ghostrun.kr/v1'

  // DB helpers (localStorage as mock server)
  _getDB(){ try{return JSON.parse(localStorage.getItem(this._DB_KEY)||'{}')}catch{return{}} },
  _saveDB(db){ localStorage.setItem(this._DB_KEY, JSON.stringify(db)) },
  _getSession(){ try{return JSON.parse(localStorage.getItem(this._SESSION_KEY)||'null')}catch{return null} },
  _saveSession(s){ localStorage.setItem(this._SESSION_KEY, JSON.stringify(s)) },
  _clearSession(){ localStorage.removeItem(this._SESSION_KEY) },

  // Simulate network delay
  _delay(ms=320){ return new Promise(r=>setTimeout(r,ms)) },

  // REGISTER
  async register(email, password, nickname){
    await this._delay();
    if(this._SRV_URL){
      const res = await fetch(this._SRV_URL+'/auth/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password,nickname})});
      const data = await res.json();
      if(!res.ok) throw new Error(data.message||'ÏÑúÎ≤Ñ Ïò§Î•ò');
      this._saveSession(data.user);
      return data.user;
    }
    // Local mock
    const db = this._getDB();
    if(db[email]) throw new Error('Ïù¥ÎØ∏ ÏÇ¨Ïö© Ï§ëÏù∏ Ïù¥Î©îÏùºÏù¥ÏóêÏöî');
    if(password.length < 6) throw new Error('ÎπÑÎ∞ÄÎ≤àÌò∏Îäî 6Ïûê Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï¥Ïöî');
    if(nickname.trim().length < 2) throw new Error('ÎãâÎÑ§ÏûÑÏùÄ 2Ïûê Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï¥Ïöî');
    const user = {
      id: 'GR_'+Date.now()+'_'+Math.random().toString(36).slice(2,7),
      email, nickname: nickname.trim(),
      avatar: 'üëª', crewId: null, crewName: null,
      totalKm: 0, runCount: 0,
      joinedAt: new Date().toISOString(),
      _pw: btoa(password) // NOT real security ‚Äî mock only
    };
    db[email] = user;
    this._saveDB(db);
    const session = {...user};delete session._pw;
    this._saveSession(session);
    return session;
  },

  // LOGIN
  async login(email, password){
    await this._delay();
    if(this._SRV_URL){
      const res = await fetch(this._SRV_URL+'/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});
      const data = await res.json();
      if(!res.ok) throw new Error(data.message||'Î°úÍ∑∏Ïù∏ Ïã§Ìå®');
      this._saveSession(data.user);
      return data.user;
    }
    // Local mock
    const db = this._getDB();
    const user = db[email];
    if(!user) throw new Error('Îì±Î°ùÎêú Ïù¥Î©îÏùºÏù¥ ÏóÜÏñ¥Ïöî');
    if(atob(user._pw||'')!==password) throw new Error('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÎßûÏßÄ ÏïäÏïÑÏöî');
    const session = {...user};delete session._pw;
    this._saveSession(session);
    return session;
  },

  // LOGOUT
  async logout(){
    await this._delay(100);
    this._clearSession();
  },

  // SOCIAL LOGIN (mock)
  async socialLogin(provider){
    await this._delay(500);
    const mockNames = {kakao:'Ïπ¥Ïπ¥Ïò§Îü¨ÎÑà',naver:'ÎÑ§Ïù¥Î≤ÑÎü¨ÎÑà',google:'Íµ¨Í∏ÄÎü¨ÎÑà'};
    const mockEmail = `${provider}_${Date.now()}@ghostrun.mock`;
    const db = this._getDB();
    if(!db[mockEmail]){
      const user = {
        id:'GR_'+provider+'_'+Date.now(),
        email:mockEmail, nickname:mockNames[provider]||provider,
        avatar:'üëª', crewId:null, crewName:null,
        totalKm:0, runCount:0,
        joinedAt:new Date().toISOString(),
        provider
      };
      db[mockEmail]=user;this._saveDB(db);
    }
    const session={...db[mockEmail]};delete session._pw;
    this._saveSession(session);
    return session;
  },

  // UPDATE USER
  async updateUser(fields){
    await this._delay(200);
    const session=this._getSession();if(!session)return;
    const db=this._getDB();
    if(db[session.email])Object.assign(db[session.email],fields);
    this._saveDB(db);
    const updated={...session,...fields};
    this._saveSession(updated);
    return updated;
  },

  // GET CURRENT USER
  currentUser(){ return this._getSession(); },

  // PING (server status)
  async ping(){
    if(this._SRV_URL){
      try{const r=await fetch(this._SRV_URL+'/ping',{signal:AbortSignal.timeout(3000)});return r.ok;}catch{return false;}
    }
    return true; // local mock always online
  }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AUTH UI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let authMode = 'login'; // 'login' | 'register'
let currentUser = null;

function showLoginScreen(){
  const ls = document.getElementById('login-screen');
  ls.style.display = 'flex';
  ls.classList.remove('out');
}
function hideLoginScreen(){
  const ls = document.getElementById('login-screen');
  ls.classList.add('out');
  setTimeout(()=>{ls.style.display='none';},600);
}

function toggleAuthMode(){
  authMode = authMode==='login' ? 'register' : 'login';
  const isReg = authMode==='register';
  document.getElementById('ls-mode-title').textContent = isReg ? 'ÌöåÏõêÍ∞ÄÏûÖ' : 'Î°úÍ∑∏Ïù∏';
  document.getElementById('ls-mode-sub').textContent = isReg ? 'ÏÉà Í≥ÑÏ†ïÏùÑ ÎßåÎì§Ïñ¥Î≥¥ÏÑ∏Ïöî' : 'Í≥ÑÏÜçÌïòÎ†§Î©¥ Î°úÍ∑∏Ïù∏ÌïòÏÑ∏Ïöî';
  document.getElementById('ls-nick').style.display = isReg ? 'block' : 'none';
  document.getElementById('ls-submit').textContent = isReg ? 'Í∞ÄÏûÖÌïòÍ∏∞' : 'Î°úÍ∑∏Ïù∏';
  document.getElementById('ls-switch').innerHTML = isReg
    ? 'Ïù¥ÎØ∏ Í≥ÑÏ†ïÏù¥ ÏûàÏúºÏã†Í∞ÄÏöî? <span>Î°úÍ∑∏Ïù∏</span>'
    : 'Í≥ÑÏ†ïÏù¥ ÏóÜÏúºÏã†Í∞ÄÏöî? <span>ÌöåÏõêÍ∞ÄÏûÖ</span>';
  document.getElementById('ls-err').textContent = '';
  document.getElementById('ls-pw').setAttribute('autocomplete', isReg ? 'new-password' : 'current-password');
}

async function submitAuth(){
  const email = document.getElementById('ls-email').value.trim();
  const pw = document.getElementById('ls-pw').value;
  const nick = document.getElementById('ls-nick').value.trim();
  const errEl = document.getElementById('ls-err');
  const btn = document.getElementById('ls-submit');

  errEl.textContent = '';
  if(!email){errEl.textContent='Ïù¥Î©îÏùºÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî';return;}
  if(!pw){errEl.textContent='ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî';return;}

  btn.textContent = 'Ï≤òÎ¶¨ Ï§ë...';btn.style.opacity='.6';btn.disabled=true;

  try{
    let user;
    if(authMode==='register'){
      if(!nick){errEl.textContent='ÎãâÎÑ§ÏûÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî';return;}
      user = await GR_API.register(email, pw, nick);
      showToast('üéâ ÌöåÏõêÍ∞ÄÏûÖÏù¥ ÏôÑÎ£åÎêêÏñ¥Ïöî!');
    } else {
      user = await GR_API.login(email, pw);
      showToast('üëª Ïñ¥ÏÑúÏò§ÏÑ∏Ïöî, '+user.nickname+'Îãò!');
    }
    onLoginSuccess(user);
  } catch(e){
    errEl.textContent = e.message;
  } finally{
    btn.textContent = authMode==='register'?'Í∞ÄÏûÖÌïòÍ∏∞':'Î°úÍ∑∏Ïù∏';
    btn.style.opacity='1';btn.disabled=false;
  }
}

async function socialLogin(provider){
  const errEl = document.getElementById('ls-err');
  errEl.textContent = provider+' Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨ Ï§ë...';
  try{
    const user = await GR_API.socialLogin(provider);
    showToast('üëª Ïñ¥ÏÑúÏò§ÏÑ∏Ïöî, '+user.nickname+'Îãò!');
    onLoginSuccess(user);
  }catch(e){errEl.textContent=e.message;}
}

function onLoginSuccess(user){
  currentUser = user;
  // Update avatar in nav
  document.getElementById('nav-profile').textContent = user.avatar||'üëª';
  // Update shot view names
  ['nm-g','nm-p','nm-s'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent=user.nickname;});
  // Update hero subtitle if in crew
  if(user.crewName){
    hasCrew=true;
    CREW=makeCrewMembers(user.crewName, user.avatar||'üëª', 2);
  }
  hideLoginScreen();
  setSrvBadge(true);
}

function openProfile(){
  if(!currentUser){showLoginScreen();return;}
  const u=currentUser;
  const box=document.getElementById('prof-box');
  box.innerHTML=`
    <div class="prof-hd">
      <div class="prof-avatar">${u.avatar||'üëª'}</div>
      <div>
        <div class="prof-name">${u.nickname}</div>
        <div class="prof-email">${u.email}</div>
        <div class="prof-joined">Í∞ÄÏûÖÏùº ${new Date(u.joinedAt).toLocaleDateString('ko-KR')}</div>
      </div>
    </div>
    <div class="prof-stats-row">
      <div class="prof-st"><span class="prof-sl">Ï¥ù Í±∞Î¶¨</span><span class="prof-sv">${(u.totalKm||312.4).toFixed(1)}<span style="font-family:var(--fb);font-size:12px;color:var(--dim)"> km</span></span></div>
      <div class="prof-st"><span class="prof-sl">Îü∞ ÌöüÏàò</span><span class="prof-sv">${u.runCount||62}<span style="font-family:var(--fb);font-size:12px;color:var(--dim)"> Ìöå</span></span></div>
      <div class="prof-st"><span class="prof-sl">ÌÅ¨Î£®</span><span class="prof-sv">${u.crewName?'1':'0'}<span style="font-family:var(--fb);font-size:12px;color:var(--dim)"> Í∞ú</span></span></div>
    </div>
    <div class="prof-menu-item" onclick="editNickname()"><span class="prof-menu-em">‚úèÔ∏è</span><span class="prof-menu-txt">ÎãâÎÑ§ÏûÑ Î≥ÄÍ≤Ω</span><span class="prof-menu-arrow">‚Ä∫</span></div>
    <div class="prof-menu-item" onclick="editAvatar()"><span class="prof-menu-em">üëª</span><span class="prof-menu-txt">ÏïÑÎ∞îÌÉÄ Î≥ÄÍ≤Ω</span><span class="prof-menu-arrow">‚Ä∫</span></div>
    <div class="prof-menu-item" onclick="showToast('Ï§ÄÎπÑ Ï§ëÏù∏ Í∏∞Îä•Ïù¥ÏóêÏöî')"><span class="prof-menu-em">üîî</span><span class="prof-menu-txt">ÏïåÎ¶º ÏÑ§Ï†ï</span><span class="prof-menu-arrow">‚Ä∫</span></div>
    <div class="prof-menu-item" onclick="showToast('Ï§ÄÎπÑ Ï§ëÏù∏ Í∏∞Îä•Ïù¥ÏóêÏöî')"><span class="prof-menu-em">üîí</span><span class="prof-menu-txt">ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω</span><span class="prof-menu-arrow">‚Ä∫</span></div>
    <button class="prof-logout" onclick="doLogout()">Î°úÍ∑∏ÏïÑÏõÉ</button>
  `;
  openModal('m-profile');
}

async function doLogout(){
  await GR_API.logout();
  currentUser=null;
  hasCrew=false;crewInited=false;nearInited=false;pastInited=false;
  document.getElementById('nav-profile').textContent='üë§';
  closeModal('m-profile');
  showLoginScreen();
  showToast('Î°úÍ∑∏ÏïÑÏõÉÎêêÏñ¥Ïöî');
}

function editNickname(){
  const newNick = prompt('ÏÉà ÎãâÎÑ§ÏûÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÏµúÎåÄ 12Ïûê)','');
  if(!newNick||newNick.trim().length<2){showToast('ÎãâÎÑ§ÏûÑÏùÄ 2Ïûê Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï¥Ïöî');return;}
  GR_API.updateUser({nickname:newNick.trim()}).then(u=>{
    currentUser=u;
    closeModal('m-profile');
    setTimeout(openProfile,200);
    showToast('ÎãâÎÑ§ÏûÑÏù¥ Î≥ÄÍ≤ΩÎêêÏñ¥Ïöî');
  });
}

function editAvatar(){
  closeModal('m-profile');
  openAv();
  // Override avc click to also update user
  document.querySelectorAll('.avc').forEach(c=>{
    c.addEventListener('click',()=>{
      const em=c.querySelector('.ave').textContent;
      GR_API.updateUser({avatar:em}).then(u=>{
        currentUser=u;
        document.getElementById('nav-profile').textContent=em;
      });
    },{once:true});
  });
}

// SERVER STATUS
function setSrvBadge(online){
  const badge=document.getElementById('srv-badge');
  const txt=document.getElementById('srv-txt');
  badge.classList.toggle('online',online);
  txt.textContent=online?'ÏÑúÎ≤Ñ Ïó∞Í≤∞Îê®':'ÏÑúÎ≤Ñ Ïò§ÌîÑÎùºÏù∏';
  setTimeout(()=>{badge.style.opacity='0';},3000);
}

async function checkServer(){
  const online=await GR_API.ping();
  setSrvBadge(online);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT: Check session on load
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
(function initApp(){
  document.getElementById('srv-badge').style.opacity='1';
  checkServer();
  const session = GR_API.currentUser();
  if(session){
    // Auto-login from stored session
    currentUser=session;
    document.getElementById('nav-profile').textContent=session.avatar||'üëª';
    ['nm-g','nm-p','nm-s'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent=session.nickname;});
    if(session.crewName){
      hasCrew=true;
      CREW=makeCrewMembers(session.crewName,session.avatar||'üëª',2);
    }
  } else {
    // Show login after splash
    // We'll show it when splash hides
  }
})();

</script>
</body>
</html>
